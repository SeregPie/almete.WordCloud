!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(t.almete=t.almete||{},t.almete.WordCloud=r())}(this,function(){"use strict";function t(t,r){if(t.length>0)return r&&(t=t.map(r)),t.reduce(function(t,r){return Math.min(t,r)})}function r(t,r){if(t.length>0)return r&&(t=t.map(r)),t.reduce(function(t,r){return Math.max(t,r)})}function e(t,r,e){var n=e().getContext("2d");return n.font=r,n.measureText(t).width}function n(t,r,e){var n,i,o=t[0],a=t[1],f=r[0],h=r[1];o>a?(n=1,i=a/o):a>o?(i=1,n=o/a):n=i=1;var u=[f,h];if(e(u))return u;for(var v=f,c=h,d=f,s=h,l=v,g=c;;){f-=n,h-=i,v+=n,c+=i;var m=Math.floor(f),x=Math.floor(h),M=Math.ceil(v),p=Math.ceil(c);if(M>l)for(var W=x;W<p;++W){var y=[M,W];if(e(y))return y}if(p>g)for(var w=M;w>m;--w){var S=[w,p];if(e(S))return S}if(m<d)for(var T=p;T>x;--T){var z=[m,T];if(e(z))return z}if(x<s)for(var R=m;R<M;++R){var b=[R,x];if(e(b))return b}d=m,s=x,l=M,g=p}}return function(i,o,a,f){void 0===f&&(f={});var h=f.text;void 0===h&&(h="");var u=f.weight;void 0===u&&(u=1);var v=f.rotation;void 0===v&&(v=0);var c=f.rotationUnit;void 0===c&&(c="turn");var d=f.fontFamily;void 0===d&&(d="serif");var s=f.fontStyle;void 0===s&&(s="normal");var l=f.fontVariant;void 0===l&&(l="normal");var g=f.fontWeight;void 0===g&&(g="normal");var m=f.spacing;void 0===m&&(m=0);var x=f.fontSizeRatio;void 0===x&&(x=0);var M=f.createCanvas;if(void 0===M&&(M=function(){return document.createElement("canvas")}),i.length>0&&o>0&&a>0){i=i.map(function(t){var r=t.text;void 0===r&&(r=h);var e=t.weight;void 0===e&&(e=u);var n=t.rotation;void 0===n&&(n=v);var i=t.rotationUnit;void 0===i&&(i=c);var o=t.fontFamily;void 0===o&&(o=d);var a=t.fontStyle;void 0===a&&(a=s);var f=t.fontVariant;void 0===f&&(f=l);var m=t.fontWeight;return void 0===m&&(m=g),{text:r,weight:e,rotationTurn:function(){switch(i){case"deg":return n/360;case"rad":return function(t){return t/2/Math.PI}(n)}return n}(),get rotationDeg(){return 360*this.rotationTurn},get rotationRad(){return 2*this.rotationTurn*Math.PI},fontFamily:o,fontStyle:a,fontVariant:f,fontWeight:m,get font(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize+"px",this.fontFamily].join(" ")},get rectWidth(){return Math.ceil(this.textWidth*Math.abs(Math.cos(this.rotationRad))+this.fontSize*Math.abs(Math.sin(this.rotationRad)))},get rectHeight(){return Math.ceil(this.textWidth*Math.abs(Math.sin(this.rotationRad))+this.fontSize*Math.abs(Math.cos(this.rotationRad)))},get rectLeft(){return this.left-this.rectWidth/2},get rectTop(){return this.top-this.rectHeight/2}}}),(x=Math.abs(x))>1&&(x=1/x),i.sort(function(t,r){return r.weight-t.weight});var p=i[0].weight,W=i[i.length-1].weight,y=W<p?x>0?1/x:W>0?p/W:p<0?W/p:1+p-W:1;1<y?i.forEach(function(t){var r,e,n;t.fontSize=(r=t.weight,(n=1)+(r-(e=W))*(y-n)/(p-e))}):i.forEach(function(t){t.fontSize=1});var w=i[0];if(w.textWidth=e(w.text,w.font,M),w.left=0,w.top=0,i.length>1){var S,T,z,R,b,E=function(){T=2+2*w.rectWidth,z=2+2*w.rectHeight,R=-Math.floor(T/2),b=-Math.floor(z/2);var t=function(t,r,e,n,i,o,a){var f=a(),h=f.getContext("2d");return f.width=i,f.height=o,h.translate(i/2,o/2),h.rotate(n),h.font=r,h.textAlign="center",h.textBaseline="middle",h.fillText(t,0,0),e>0&&(h.miterLimit=1,h.lineWidth=e,h.strokeText(t,0,0)),h.getImageData(0,0,i,o).data}(w.text,w.font,0,w.rotationRad,T,z,M);S=[];for(var r=0;r<T;++r)for(var e=0;e<z;++e)t[4*(T*e+r)+3]&&S.push([r,e])};E();for(var C={},F=1,H=i.length;F<H;++F){var L;S.forEach(function(t){var r=t[0],e=t[1];C[R+r+"|"+(b+e)]=!0}),(w=i[F]).textWidth=e(w.text,w.font,M),E(),L=n([o,a],[R,b],function(t){var r=t[0],e=t[1];return S.every(function(t){var n=t[0],i=t[1];return!C[r+n+"|"+(e+i)]})}),R=L[0],b=L[1],w.left=R+T/2,w.top=b+z/2}}var V=t(i,function(t){return t.rectLeft}),I=r(i,function(t){return t.rectLeft+t.rectWidth}),j=I-V,D=I+V,P=t(i,function(t){return t.rectTop}),U=r(i,function(t){return t.rectTop+t.rectHeight}),k=U-P,A=U+P,B=Math.min(o/j,a/k);return i.forEach(function(t){t.left-=D/2,t.top-=A/2,t.fontSize*=B,t.textWidth*=B,t.left*=B,t.top*=B,t.left+=o/2,t.top+=a/2}),i}return[]}});
