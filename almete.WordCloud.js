!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):((t=t||self).almete=t.almete||{},t.almete.WordCloud=i())}(this,function(){"use strict";var t=Math.PI/180;var i=180/Math.PI;var n=2/Math.PI;var r=2*Math.PI;function o(t,i,n){return Math.ceil(t*Math.abs(Math.sin(n))+i*Math.abs(Math.cos(n)))}function a(t,i,n){return Math.ceil(t*Math.abs(Math.cos(n))+i*Math.abs(Math.sin(n)))}function h(t,i,n,r,o){return[t,i,n,r+"px",o].join(" ")}var e=function(t){this.t=t,this.i()},u={o:{configurable:!0},h:{configurable:!0},u:{configurable:!0},s:{configurable:!0}};u.o.get=function(){return Math.floor((this.v+this.M)/2)},u.h.get=function(){return Math.floor((this.l+this.g)/2)},u.u.get=function(){return this.M-this.v+1},u.s.get=function(){return this.g-this.l+1},e.prototype._=function(t,i,n){for(var r=0;r<t.width;r++)for(var o=0;o<t.height;o++)if(t.data[4*(t.width*o+r)+3]){var a=i+r,h=n+o;this.m[a+"|"+h]=!0,this.v=Math.min(a,this.v),this.l=Math.min(h,this.l),this.M=Math.max(a,this.M),this.g=Math.max(h,this.g)}},e.prototype.p=function(t,i,n){var r=this;return t.every(function(t){var o=t[0],a=t[1],h=i+o,e=n+a;return!r.m[h+"|"+e]})},e.prototype.T=function(t){for(var i=this,n=[],r=0;r<t.width;r++)for(var o=0;o<t.height;o++)t.data[4*(t.width*o+r)+3]&&n.push([r,o]);if(n.length){var a=n.reduce(function(t,i){var n=t[0],r=t[1],o=i[0],a=i[1];return[Math.min(o,n),Math.min(a,r)]}),h=a[0],e=a[1],u=n.reduce(function(t,i){var n=t[0],r=t[1],o=i[0],a=i[1];return[Math.max(o,n),Math.max(a,r)]}),f=u[0],s=u[1],v=n.map(function(t){var i=t[0],n=t[1];return[i-h,n-e]}),c=f-h+1,d=s-e+1,M=function(t,i,n){var r,o,a=t[0],h=t[1],e=i[0],u=i[1];a>h?(r=1,o=h/a):h>a?(o=1,r=a/h):r=o=1;var f=[e,u];if(n(f))return f;for(var s=e,v=u,c=e,d=u,M=s,l=v;;){e-=r,u-=o,s+=r,v+=o;var g=Math.floor(e),_=Math.floor(u),b=Math.ceil(s),m=Math.ceil(v);if(b>M)for(var p=_;p<m;++p){var w=[b,p];if(n(w))return w}if(m>l)for(var x=b;x>g;--x){var y=[x,m];if(n(y))return y}if(g<c)for(var T=m;T>_;--T){var W=[g,T];if(n(W))return W}if(_<d)for(var j=g;j<b;++j){var L=[j,_];if(n(L))return L}c=g,d=_,M=b,l=m}}(this.t,[this.o-Math.floor(c/2),this.h-Math.floor(d/2)],function(t){var n=t[0],r=t[1];return i.p(v,n,r)}),l=M[0],g=M[1];return[l-h,g-e]}return[0,0]},e.prototype.i=function(){this.m={},this.v=1,this.l=1,this.M=0,this.g=0},Object.defineProperties(e.prototype,u);var f=4;return function(u,s,v,c){void 0===c&&(c={});var d=c.createCanvas;void 0===d&&(d=function(){return document.createElement("canvas")});var M=c.fontFamily;void 0===M&&(M="serif");var l=c.fontSizeRatio;void 0===l&&(l=0);var g=c.fontStyle;void 0===g&&(g="normal");var _=c.fontVariant;void 0===_&&(_="normal");var b=c.fontWeight;void 0===b&&(b="normal");var m=c.gap;void 0===m&&(m=0);var p=c.rotation;void 0===p&&(p=0);var w=c.rotationUnit;void 0===w&&(w="turn");var x=c.text;void 0===x&&(x="");var y,T=c.weight;if(void 0===T&&(T=1),s&&v){var W=function(){function t(){this.W=1,this.j=0,this.L=0}var r={O:{configurable:!0},S:{configurable:!0},D:{configurable:!0},F:{configurable:!0},o:{configurable:!0},h:{configurable:!0},u:{configurable:!0},s:{configurable:!0}};return r.O.get=function(){return h(this.R,this.V,this.k,this.W,this.q)},r.S.get=function(){return this.A*this.W},r.D.get=function(){return this.B*i},r.F.get=function(){return this.B*n},r.o.get=function(){return this.j+this.u/2},r.h.get=function(){return this.L+this.s/2},r.u.get=function(){return a(this.S,this.W,this.B)},r.s.get=function(){return o(this.S,this.W,this.B)},t.prototype.C=function(t){var i=t*this.W,n=d();n.width=Math.round(a(i+2*this.W+this.S,i+3*this.W,this.B)),n.height=Math.round(o(i+2*this.W+this.S,i+3*this.W,this.B));var r=n.getContext("2d");return r.translate(n.width/2,n.height/2),r.rotate(this.B),r.font=this.O,r.textAlign="center",r.textBaseline="middle",r.fillText(this.G,0,0),i>0&&(r.miterLimit=1,r.lineWidth=i,r.strokeText(this.G,0,0)),r.getImageData(0,0,n.width,n.height)},t.prototype.T=function(t){var i=this.C(2*m),n=t.T(i),r=n[0],o=n[1];this.j=r+(i.width-this.u)/2,this.L=o+(i.height-this.s)/2},t.prototype._=function(t){var i=this.C(0),n=Math.round(this.j-(i.width-this.u)/2),r=Math.round(this.L-(i.height-this.s)/2);t._(i,n,r)},Object.defineProperties(t.prototype,r),t}();u=u.map(function(i){var n=i.fontFamily;void 0===n&&(n=M);var o=i.fontStyle;void 0===o&&(o=g);var a=i.fontVariant;void 0===a&&(a=_);var e=i.fontWeight;void 0===e&&(e=b);var u=i.rotation;void 0===u&&(u=p);var f=i.rotationUnit;void 0===f&&(f=w);var s=i.text;void 0===s&&(s=x);var v,c=i.weight;return void 0===c&&(c=T),Object.assign(new W,{q:n,R:o,V:a,k:e,A:(v=d().getContext("2d"),v.font=h(o,a,e,1,n),v.measureText(s).width),B:function(){switch(f){case"deg":return u*t;case"turn":return function(t){return t*r}(u)}return u}(),G:s,H:c})}).filter(function(t){return t.S});var j=function(t){u.forEach(function(i){i.W*=t,i.j*=t,i.L*=t})};if(u.length){var L=u.slice().sort(function(t,i){return i.H-t.H}),O=L[0],S=(y=L)[function(t){return t.length-1}(y)],D=O.H,F=S.H;F<D&&(l=(l=Math.abs(l))>1?l:l>0?1/l:F>0?D/F:D<0?F/D:1+D-F,u.forEach(function(t){var i,n,r;t.W=(i=t.H,((r=1/l)+(i-(n=F))*(1-r)/(D-n))*f)}));var R=new e([s,v]);return L.reduce(function(t,i,n){if(i.W<f){do{j(2)}while(i.W<f);R.i(),L.slice(0,n).forEach(function(t){t._(R)})}else t._(R);return i.T(R),i}),S._(R),R.u&&R.s&&(u.forEach(function(t){t.j-=R.o,t.L-=R.h}),j(Math.min(s/R.u,v/R.s)),u.forEach(function(t){t.j+=s/2,t.L+=v/2})),u.map(function(t){return{centerLeft:t.o,centerTop:t.h,font:t.O,fontFamily:t.q,fontSize:t.W,fontStyle:t.R,fontVariant:t.V,fontWeight:t.k,height:t.s,left:t.j,rotationDeg:t.D,rotationRad:t.B,rotationTurn:t.F,text:t.G,textWidth:t.S,top:t.L,weight:t.H,width:t.u}})}}return[]}});
