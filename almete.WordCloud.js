!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):((t=t||self).almete=t.almete||{},t.almete.WordCloud=i())}(this,function(){"use strict";function t(t,i,n){return Math.ceil(t*Math.abs(Math.sin(n))+i*Math.abs(Math.cos(n)))}function i(t,i,n){return Math.ceil(t*Math.abs(Math.cos(n))+i*Math.abs(Math.sin(n)))}function n(t,i,n,r,h){return[t,i,n,r+"px",h].join(" ")}var r=function(t){this.t=t,this.i()},h={h:{configurable:!0},o:{configurable:!0},u:{configurable:!0},s:{configurable:!0}};h.h.get=function(){return Math.floor((this.v+this.M)/2)},h.o.get=function(){return Math.floor((this.l+this.g)/2)},h.u.get=function(){return this.M-this.v+1},h.s.get=function(){return this.g-this.l+1},r.prototype._=function(t,i,n){for(var r=0;r<t.width;r++)for(var h=0;h<t.height;h++)if(t.data[4*(t.width*h+r)+3]){var o=i+r,a=n+h;this.m[o+"|"+a]=!0,this.v=Math.min(o,this.v),this.l=Math.min(a,this.l),this.M=Math.max(o,this.M),this.g=Math.max(a,this.g)}},r.prototype.p=function(t,i,n){var r=this;return t.every(function(t){var h=t[0],o=t[1],a=i+h,e=n+o;return!r.m[a+"|"+e]})},r.prototype.T=function(t){for(var i=this,n=[],r=0;r<t.width;r++)for(var h=0;h<t.height;h++)t.data[4*(t.width*h+r)+3]&&n.push([r,h]);if(n.length){var o=n.reduce(function(t,i){var n=t[0],r=t[1],h=i[0],o=i[1];return[Math.min(h,n),Math.min(o,r)]}),a=o[0],e=o[1],u=n.reduce(function(t,i){var n=t[0],r=t[1],h=i[0],o=i[1];return[Math.max(h,n),Math.max(o,r)]}),f=u[0],s=u[1],c=n.map(function(t){var i=t[0],n=t[1];return[i-a,n-e]}),v=f-a+1,d=s-e+1,M=function(t,i,n){var r,h,o=t[0],a=t[1],e=i[0],u=i[1];o>a?(r=1,h=a/o):a>o?(h=1,r=o/a):r=h=1;var f=[e,u];if(n(f))return f;for(var s=e,c=u,v=e,d=u,M=s,l=c;;){e-=r,u-=h,s+=r,c+=h;var g=Math.floor(e),_=Math.floor(u),b=Math.ceil(s),m=Math.ceil(c);if(b>M)for(var p=_;p<m;++p){var w=[b,p];if(n(w))return w}if(m>l)for(var x=b;x>g;--x){var y=[x,m];if(n(y))return y}if(g<v)for(var T=m;T>_;--T){var W=[g,T];if(n(W))return W}if(_<d)for(var j=g;j<b;++j){var L=[j,_];if(n(L))return L}v=g,d=_,M=b,l=m}}(this.t,[this.h-Math.floor(v/2),this.o-Math.floor(d/2)],function(t){var n=t[0],r=t[1];return i.p(c,n,r)}),l=M[0],g=M[1];return[l-a,g-e]}return[0,0]},r.prototype.i=function(){this.m={},this.v=1,this.l=1,this.M=0,this.g=0},Object.defineProperties(r.prototype,h);var o=4;return function(h,a,e,u){void 0===u&&(u={});var f=u.createCanvas;void 0===f&&(f=function(){return document.createElement("canvas")});var s=u.fontFamily;void 0===s&&(s="serif");var c=u.fontSizeRatio;void 0===c&&(c=0);var v=u.fontStyle;void 0===v&&(v="normal");var d=u.fontVariant;void 0===d&&(d="normal");var M=u.fontWeight;void 0===M&&(M="normal");var l=u.gap;void 0===l&&(l=0);var g=u.rotation;void 0===g&&(g=0);var _=u.rotationUnit;void 0===_&&(_="turn");var b=u.text;void 0===b&&(b="");var m,p=u.weight;if(void 0===p&&(p=1),a&&e){var w=function(){function r(){this.W=1,this.j=0,this.L=0}var h={O:{configurable:!0},S:{configurable:!0},D:{configurable:!0},F:{configurable:!0},h:{configurable:!0},o:{configurable:!0},u:{configurable:!0},s:{configurable:!0}};return h.O.get=function(){return n(this.R,this.V,this.k,this.W,this.q)},h.S.get=function(){return this.A*this.W},h.D.get=function(){return 180*this.B/Math.PI},h.F.get=function(){return this.B/2/Math.PI},h.h.get=function(){return this.j+this.u/2},h.o.get=function(){return this.L+this.s/2},h.u.get=function(){return i(this.S,this.W,this.B)},h.s.get=function(){return t(this.S,this.W,this.B)},r.prototype.C=function(n){var r=n*this.W,h=f();h.width=Math.round(i(r+2*this.W+this.S,r+3*this.W,this.B)),h.height=Math.round(t(r+2*this.W+this.S,r+3*this.W,this.B));var o=h.getContext("2d");return o.translate(h.width/2,h.height/2),o.rotate(this.B),o.font=this.O,o.textAlign="center",o.textBaseline="middle",o.fillText(this.G,0,0),r>0&&(o.miterLimit=1,o.lineWidth=r,o.strokeText(this.G,0,0)),o.getImageData(0,0,h.width,h.height)},r.prototype.T=function(t){var i=this.C(2*l),n=t.T(i),r=n[0],h=n[1];this.j=r+(i.width-this.u)/2,this.L=h+(i.height-this.s)/2},r.prototype._=function(t){var i=this.C(0),n=Math.round(this.j-(i.width-this.u)/2),r=Math.round(this.L-(i.height-this.s)/2);t._(i,n,r)},r.prototype.H=function(t){this.W*=t,this.j*=t,this.L*=t},Object.defineProperties(r.prototype,h),r}();if((h=h.map(function(t){var i=t.fontFamily;void 0===i&&(i=s);var r=t.fontStyle;void 0===r&&(r=v);var h=t.fontVariant;void 0===h&&(h=d);var o=t.fontWeight;void 0===o&&(o=M);var a=t.rotation;void 0===a&&(a=g);var e=t.rotationUnit;void 0===e&&(e=_);var u=t.text;void 0===u&&(u=b);var c,l=t.weight;return void 0===l&&(l=p),Object.assign(new w,{q:i,R:r,V:h,k:o,A:(c=f().getContext("2d"),c.font=n(r,h,o,1,i),c.measureText(u).width),B:function(){switch(e){case"deg":return a*Math.PI/180;case"turn":return function(t){return t*Math.PI*2}(a)}return a}(),G:u,I:l})}).filter(function(t){return t.S})).length){var x=h.slice().sort(function(t,i){return i.I-t.I}),y=x[0],T=(m=x)[function(t){return t.length-1}(m)],W=y.I,j=T.I;j<W&&(c=(c=Math.abs(c))>1?c:c>0?1/c:j>0?W/j:W<0?j/W:1+W-j,h.forEach(function(t){var i,n,r;t.W=(i=t.I,((r=1/c)+(i-(n=j))*(1-r)/(W-n))*o)}));var L=new r([a,e]);if(x.reduce(function(t,i,n){if(i.W<o){do{h.forEach(function(t){t.H(2)})}while(i.W<o);L.i(),x.slice(0,n).forEach(function(t){t._(L)})}else t._(L);return i.T(L),i}),T._(L),L.u&&L.s){var O=Math.min(a/L.u,e/L.s);h.forEach(function(t){t.j-=L.h,t.L-=L.o,t.H(O),t.j+=a/2,t.L+=e/2})}return h.map(function(t){return{centerLeft:t.h,centerTop:t.o,font:t.O,fontFamily:t.q,fontSize:t.W,fontStyle:t.R,fontVariant:t.V,fontWeight:t.k,height:t.s,left:t.j,rotationDeg:t.D,rotationRad:t.B,rotationTurn:t.F,text:t.G,textWidth:t.S,top:t.L,weight:t.I,width:t.u}})}}return[]}});
