!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t.almete=t.almete||{},t.almete.WordCloud=i())}(this,function(){"use strict";function t(t,i){if(t.length>0)return i&&(t=t.map(i)),t.reduce(function(t,i){return Math.min(t,i)})}function i(t,i){if(t.length>0)return i&&(t=t.map(i)),t.reduce(function(t,i){return Math.max(t,i)})}function n(t,i,n){return Math.ceil(t*Math.abs(Math.sin(n))+i*Math.abs(Math.cos(n)))}function r(t,i,n){return Math.ceil(t*Math.abs(Math.cos(n))+i*Math.abs(Math.sin(n)))}function o(t,i){return Math.ceil(t/i)*i}var h=function(t,i,n,r,o,h,u,e,a,f){this.t=t,this.i=i,this.n=function(){switch(r){case"deg":return n/360;case"rad":return function(t){return t/2/Math.PI}(n)}return n}(),this.r=o,this.o=h,this.h=u,this.u=e,this.e=a,this.a=0,this.f=0,this.s=0,this.c=f},u={v:{configurable:!0},d:{configurable:!0},g:{configurable:!0},l:{configurable:!0},M:{configurable:!0},b:{configurable:!0},$:{configurable:!0},m:{configurable:!0},p:{configurable:!0},W:{configurable:!0},x:{configurable:!0},y:{configurable:!0},T:{configurable:!0},w:{configurable:!0},H:{configurable:!0},L:{configurable:!0},j:{configurable:!0}};u.v.get=function(){return 360*this.n},u.d.get=function(){return this.n*Math.PI*2},u.g.get=function(){return[this.r,this.o,this.h,this.u+"px",this.e].join(" ")},h.prototype.D=function(){var t=this.c.call().getContext("2d");return t.font=this.g,t.measureText(this.t).width/this.u},u.l.get=function(){return void 0===this.P&&(this.P=this.D()),this.P},u.M.get=function(){return this.l*this.u},u.b.get=function(){return r(this.M,this.u,this.d)},u.$.get=function(){return n(this.M,this.u,this.d)},u.m.get=function(){return this.f-this.b/2},u.p.get=function(){return this.s-this.$/2},u.W.get=function(){return this.a},u.W.set=function(t){this.a!==t&&(this.a=t,this.R=void 0)},u.x.get=function(){return this.W*this.u},u.y.get=function(){return o(r(this.M+2*(this.x+this.u),this.u+2*(this.x+this.u),this.d),2)},u.T.get=function(){return o(n(this.M+2*(this.x+this.u),this.u+2*(this.x+this.u),this.d),2)},u.w.get=function(){return 2*this.x},h.prototype.S=function(){var t=this.c.call(),i=t.getContext("2d");t.width=this.y,t.height=this.T,i.translate(this.y/2,this.T/2),i.rotate(this.d),i.font=this.g,i.textAlign="center",i.textBaseline="middle",i.fillText(this.t,0,0),this.w>0&&(i.miterLimit=1,i.lineWidth=this.w,i.strokeText(this.t,0,0));for(var n=i.getImageData(0,0,this.y,this.T).data,r=[],o=0;o<this.y;++o)for(var h=0;h<this.T;++h)n[4*(this.y*h+o)+3]&&r.push([o,h]);return r},u.H.get=function(){return void 0===this.R&&(this.R=this.S()),this.R},u.L.get=function(){return this.f-this.y/2},u.L.set=function(t){this.f=t+this.y/2},u.j.get=function(){return this.s-this.T/2},u.j.set=function(t){this.s=t+this.T/2},h.prototype.z=function(t){this.u*=t,this.f*=t,this.s*=t,this.R=void 0},Object.defineProperties(h.prototype,u);var e=function(t){this.F=t,this.O={}};e.prototype.V=function(t,i,n){var r=this;t.forEach(function(t){var o=t[0],h=t[1],u=i+o,e=n+h;r.O[u+"|"+e]=!0})},e.prototype.k=function(t,i,n){var r=this;return t.every(function(t){var o=t[0],h=t[1],u=i+o,e=n+h;return!r.O[u+"|"+e]})},e.prototype.q=function(t,i,n){var r=this;return function(t,i,n){var r,o,h=t[0],u=t[1],e=i[0],a=i[1];h>u?(r=1,o=u/h):u>h?(o=1,r=h/u):r=o=1;var f=[e,a];if(n(f))return f;for(var s=e,c=a,v=e,d=a,g=s,l=c;;){e-=r,a-=o,s+=r,c+=o;var M=Math.floor(e),b=Math.floor(a),$=Math.ceil(s),m=Math.ceil(c);if($>g)for(var p=b;p<m;++p){var W=[$,p];if(n(W))return W}if(m>l)for(var x=$;x>M;--x){var y=[x,m];if(n(y))return y}if(M<v)for(var T=m;T>b;--T){var w=[M,T];if(n(w))return w}if(b<d)for(var H=M;H<$;++H){var L=[H,b];if(n(L))return L}v=M,d=b,g=$,l=m}}(this.F,[i,n],function(i){var n=i[0],o=i[1];return r.k(t,n,o)})};var a=4;return function(n,r,o,u){void 0===u&&(u={});var f=u.text;void 0===f&&(f="");var s=u.weight;void 0===s&&(s=1);var c=u.rotation;void 0===c&&(c=0);var v=u.rotationUnit;void 0===v&&(v="turn");var d=u.fontFamily;void 0===d&&(d="serif");var g=u.fontStyle;void 0===g&&(g="normal");var l=u.fontVariant;void 0===l&&(l="normal");var M=u.fontWeight;void 0===M&&(M="normal");var b=u.spacing;void 0===b&&(b=0);var $=u.fontSizeRatio;void 0===$&&($=0);var m=u.createCanvas;if(void 0===m&&(m=function(){return document.createElement("canvas")}),n.length>0&&r>0&&o>0){n=n.map(function(t){var i=t.text;void 0===i&&(i=f);var n=t.weight;void 0===n&&(n=s);var r=t.rotation;void 0===r&&(r=c);var o=t.rotationUnit;void 0===o&&(o=v);var u=t.fontFamily;void 0===u&&(u=d);var e=t.fontStyle;void 0===e&&(e=g);var b=t.fontVariant;void 0===b&&(b=l);var $=t.fontWeight;return void 0===$&&($=M),new h(i,n,r,o,e,b,$,a,u,m)}),($=Math.abs($))>1&&($=1/$),n.sort(function(t,i){return i.i-t.i});var p=n[0].i,W=n[n.length-1].i;W<p&&($=$>0?1/$:W>0?p/W:p<0?W/p:1+p-W,n.forEach(function(t){var i,n,r;t.u*=(i=t.i,(r=1)+(i-(n=W))*($-r)/(p-n))}));var x=new e([r,o]);n.reduce(function(t,i){t.W=0,x.V(t.H,t.L,t.j),i.W=b;var n=x.q(i.H,i.L,i.j),r=n[0],o=n[1];return i.L=r,i.j=o,i});var y=t(n,function(t){return t.m}),T=i(n,function(t){return t.m+t.b}),w=T-y,H=T+y,L=t(n,function(t){return t.p}),j=i(n,function(t){return t.p+t.$}),D=j-L,P=j+L,R=Math.min(r/w,o/D);return n.forEach(function(t){t.f-=H/2,t.s-=P/2,t.z(R),t.f+=r/2,t.s+=o/2}),n=n.map(function(t){return{text:t.t,rotationTurn:t.n,rotationDeg:t.v,rotationRad:t.d,fontStyle:t.r,fontVariant:t.o,fontWeight:t.h,fontSize:t.u,fontFamily:t.e,font:t.g,textWidth:t.M,rectWidth:t.b,rectHeight:t.$,rectLeft:t.m,rectTop:t.p,left:t.f,top:t.s}})}return[]}});
