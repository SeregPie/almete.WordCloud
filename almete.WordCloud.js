!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t.almete=t.almete||{},t.almete.WordCloud=i())}(this,function(){"use strict";function t(t,i){if(t.length>0)return i&&(t=t.map(i)),t.reduce(function(t,i){return Math.min(t,i)})}function i(t,i){if(t.length>0)return i&&(t=t.map(i)),t.reduce(function(t,i){return Math.max(t,i)})}function e(t,i){return Math.ceil(t/i)*i}function n(t,i,e){return Math.ceil(t*Math.abs(Math.cos(e))+i*Math.abs(Math.sin(e)))}function r(t,i,e){return Math.ceil(t*Math.abs(Math.sin(e))+i*Math.abs(Math.cos(e)))}function a(t,i,a,o,h,f,s,d,u,g){return t.map(function(t){var c=t.text;void 0===c&&(c=i);var v=t.weight;void 0===v&&(v=a);var l=t.rotation;void 0===l&&(l=o);var m=t.rotationUnit;void 0===m&&(m=h);var x=t.fontFamily;void 0===x&&(x=f);var p=t.fontStyle;void 0===p&&(p=s);var W=t.fontVariant;void 0===W&&(W=d);var S=t.fontWeight;return void 0===S&&(S=u),{text:c,weight:v,rotationTurn:function(){switch(m){case"deg":return l/360;case"rad":return function(t){return t/2/Math.PI}(l)}return l}(),get rotationDeg(){return 360*this.rotationTurn},get rotationRad(){return this.rotationTurn*Math.PI*2},fontStyle:p,fontVariant:W,fontWeight:S,get fontSize(){return this._fontSize},set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this._textWidth=void 0,this._imagePixels=void 0)},fontFamily:x,get font(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize+"px",this.fontFamily].join(" ")},get textWidth(){return void 0===this._textWidth&&(this._textWidth=function(t,i,e){var n=e().getContext("2d");return n.font=i,n.measureText(t).width}(this.text,this.font,g)),this._textWidth},left:0,top:0,get rectWidth(){return n(this.textWidth,this.fontSize,this.rotationRad)},get rectHeight(){return r(this.textWidth,this.fontSize,this.rotationRad)},get rectLeft(){return this.left-this.rectWidth/2},get rectTop(){return this.top-this.rectHeight/2},get padding(){return this._padding},set padding(t){this._padding!==t&&(this._padding=t,this._imagePixels=void 0)},get paddingInPixels(){return this.fontSize*this.padding},get imageWidth(){return e(n(this.textWidth+2*(this.paddingInPixels+this.fontSize),this.fontSize+2*(this.paddingInPixels+this.fontSize),this.rotationRad),2)},get imageHeight(){return e(r(this.textWidth+2*(this.paddingInPixels+this.fontSize),this.fontSize+2*(this.paddingInPixels+this.fontSize),this.rotationRad),2)},get lineWidth(){return 2*this.paddingInPixels},get imagePixels(){return void 0===this._imagePixels&&(this._imagePixels=function(t,i,e,n,r,a,o){var h=o(),f=h.getContext("2d");h.width=r,h.height=a,f.translate(r/2,a/2),f.rotate(n),f.font=e,f.textAlign="center",f.textBaseline="middle",f.fillText(t,0,0),i>0&&(f.miterLimit=1,f.lineWidth=i,f.strokeText(t,0,0));for(var s=f.getImageData(0,0,r,a).data,d=[],u=0;u<r;++u)for(var g=0;g<a;++g)s[4*(r*g+u)+3]&&d.push([u,g]);return d}(this.text,this.lineWidth,this.font,this.rotationRad,this.imageWidth,this.imageHeight,g)),this._imagePixels},get imageLeft(){return this.left-this.imageWidth/2},set imageLeft(t){this.left=t+this.imageWidth/2},get imageTop(){return this.top-this.imageHeight/2},set imageTop(t){this.top=t+this.imageHeight/2}}})}function o(t){var i={};return{placePixels:function(t,e,n){t.forEach(function(t){var r=t[0],a=t[1];i[e+r+"|"+(n+a)]=!0})},fitPixels:function(e,n,r){return function(t,i,e){var n,r,a=t[0],o=t[1],h=i[0],f=i[1];a>o?(n=1,r=o/a):o>a?(r=1,n=a/o):n=r=1;var s=[h,f];if(e(s))return s;for(var d=h,u=f,g=h,c=f,v=d,l=u;;){h-=n,f-=r,d+=n,u+=r;var m=Math.floor(h),x=Math.floor(f),p=Math.ceil(d),W=Math.ceil(u);if(p>v)for(var S=x;S<W;++S){var M=[p,S];if(e(M))return M}if(W>l)for(var P=p;P>m;--P){var z=[P,W];if(e(z))return z}if(m<g)for(var _=W;_>x;--_){var T=[m,_];if(e(T))return T}if(x<c)for(var y=m;y<p;++y){var w=[y,x];if(e(w))return w}g=m,c=x,v=p,l=W}}(t,[n,r],function(t){var n=t[0],r=t[1];return e.every(function(t){var e=t[0],a=t[1];return!i[n+e+"|"+(r+a)]})})}}}var h=4;return function(e,n,r,f){void 0===f&&(f={});var s=f.text;void 0===s&&(s="");var d=f.weight;void 0===d&&(d=1);var u=f.rotation;void 0===u&&(u=0);var g=f.rotationUnit;void 0===g&&(g="turn");var c=f.fontFamily;void 0===c&&(c="serif");var v=f.fontStyle;void 0===v&&(v="normal");var l=f.fontVariant;void 0===l&&(l="normal");var m=f.fontWeight;void 0===m&&(m="normal");var x=f.spacing;void 0===x&&(x=0);var p=f.fontSizeRatio;void 0===p&&(p=0);var W=f.createCanvas;if(void 0===W&&(W=function(){return document.createElement("canvas")}),e.length>0&&n>0&&r>0){e=a(e,s,d,u,g,c,v,l,m,W),(p=Math.abs(p))>1&&(p=1/p),e.sort(function(t,i){return i.weight-t.weight});var S=e[0].weight,M=e[e.length-1].weight;if(M<S?(p=p>0?1/p:M>0?S/M:S<0?M/S:1+S-M,e.forEach(function(t){var i,e,n;t.fontSize=h*(i=t.weight,(n=1)+(i-(e=M))*(p-n)/(S-e))})):e.forEach(function(t){t.fontSize=h}),e.length>1){var P=o([n,r]);e.reduce(function(t,i){t.padding=0,P.placePixels(t.imagePixels,t.imageLeft,t.imageTop),i.padding=x;var e=P.fitPixels(i.imagePixels,i.imageLeft,i.imageTop),n=e[0],r=e[1];return i.imageLeft=n,i.imageTop=r,i})}var z=t(e,function(t){return t.rectLeft}),_=i(e,function(t){return t.rectLeft+t.rectWidth}),T=_-z,y=_+z,w=t(e,function(t){return t.rectTop}),I=i(e,function(t){return t.rectTop+t.rectHeight}),L=I-w,H=I+w,R=Math.min(n/T,r/L);return e.forEach(function(t){t.left-=y/2,t.top-=H/2,t.fontSize*=R,t.left*=R,t.top*=R,t.left+=n/2,t.top+=r/2}),e}return[]}});
