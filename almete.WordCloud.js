!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t.almete=t.almete||{},t.almete.WordCloud=i())}(this,function(){"use strict";function t(t,i){if(t.length>0)return i&&(t=t.map(i)),t.reduce(function(t,i){return Math.min(t,i)})}function i(t,i){if(t.length>0)return i&&(t=t.map(i)),t.reduce(function(t,i){return Math.max(t,i)})}function n(t,i,n){return Math.ceil(t*Math.abs(Math.sin(n))+i*Math.abs(Math.cos(n)))}function r(t,i,n){return Math.ceil(t*Math.abs(Math.cos(n))+i*Math.abs(Math.sin(n)))}function o(t,i,n,r,o){return[t,i,n,r+"px",o].join(" ")}var u=function(t,i,n,r,o,u,e,h,f){this.t=t,this.i=i,this.n=function(){switch(r){case"deg":return n/360;case"rad":return function(t){return t/2/Math.PI}(n)}return n}(),this.r=o,this.o=u,this.u=e,this.e=h,this.h=0,this.f=0,this.a=f,this.s=0,this.c=1},e={v:{configurable:!0},d:{configurable:!0},g:{configurable:!0},l:{configurable:!0},b:{configurable:!0},M:{configurable:!0},$:{configurable:!0},m:{configurable:!0},x:{configurable:!0},p:{configurable:!0},B:{configurable:!0},W:{configurable:!0},T:{configurable:!0},y:{configurable:!0},S:{configurable:!0},w:{configurable:!0},L:{configurable:!0},D:{configurable:!0},H:{configurable:!0},j:{configurable:!0},z:{configurable:!0},P:{configurable:!0}};e.v.get=function(){return 360*this.n},e.d.get=function(){return this.n*Math.PI*2},e.g.get=function(){return this.c},e.g.set=function(t){this.c!==t&&(this.c=t,this.R=void 0)},e.l.get=function(){return o(this.o,this.u,this.e,this.g,this.r)},e.b.get=function(){var t,i,n,r;return void 0===this.F&&(this.F=(t=this.t,i=o(this.o,this.u,this.e,1,this.r),n=this.a,(r=n().getContext("2d")).font=i,r.measureText(t).width)),this.F},e.M.get=function(){return this.b*this.g},e.$.get=function(){return this.h*this.g},e.$.set=function(t){this.h=t/this.g},e.m.get=function(){return this.f*this.g},e.m.set=function(t){this.f=t/this.g},e.x.get=function(){return r(this.M,this.g,this.d)},e.p.get=function(){return n(this.M,this.g,this.d)},e.B.get=function(){return this.$-this.x/2},e.W.get=function(){return this.m-this.p/2},e.T.get=function(){return this.s},e.T.set=function(t){this.s!==t&&(this.s=t,this.R=void 0)},e.y.get=function(){return this.T*this.g},e.S.get=function(){return void 0===this.R&&(this.R=function(n,r,o,u,e,h,f){var a=f(),s=a.getContext("2d");a.width=e,a.height=h,s.translate(e/2,h/2),s.rotate(u),s.font=r,s.textAlign="center",s.textBaseline="middle",s.fillText(n,0,0),o>0&&(s.miterLimit=1,s.lineWidth=o,s.strokeText(n,0,0));for(var c=s.getImageData(0,0,e,h).data,v=[],d=0;d<e;++d)for(var g=0;g<h;++g)c[4*(e*g+d)+3]&&v.push([d,g]);if(v.length<1)return[v,0,0,0,0];var l=t(v,function(t){return t[0]}),b=i(v,function(t){return t[0]})+1,M=t(v,function(t){return t[1]}),$=i(v,function(t){return t[1]})+1;return[v.map(function(t){var i=t[0],n=t[1];return[i-l,n-M]}),b-l,$-M,Math.ceil(e/2)-l,Math.ceil(h/2)-M]}(this.t,this.l,2*this.y,this.d,r(this.M+2*(this.y+this.g),this.g+2*(this.y+this.g),this.d),n(this.M+2*(this.y+this.g),this.g+2*(this.y+this.g),this.d),this.a)),this.R},e.w.get=function(){return this.S[0]},e.L.get=function(){return this.S[1]},e.D.get=function(){return this.S[2]},e.H.get=function(){return this.S[3]},e.j.get=function(){return this.S[4]},e.z.get=function(){return Math.ceil(this.$-this.H)},e.z.set=function(t){this.$=t+this.H},e.P.get=function(){return Math.ceil(this.m-this.j)},e.P.set=function(t){this.m=t+this.j},Object.defineProperties(u.prototype,e);var h=function(t){this.O=t,this.V={}};h.prototype.k=function(t,i,n){var r=this;t.forEach(function(t){var o=t[0],u=t[1],e=i+o,h=n+u;r.V[e+"|"+h]=!0})},h.prototype.q=function(t,i,n){var r=this;return t.every(function(t){var o=t[0],u=t[1],e=i+o,h=n+u;return!r.V[e+"|"+h]})},h.prototype.A=function(t,i,n){var r=this;return function(t,i,n){var r,o,u=t[0],e=t[1],h=i[0],f=i[1];u>e?(r=1,o=e/u):e>u?(o=1,r=u/e):r=o=1;var a=[h,f];if(n(a))return a;for(var s=h,c=f,v=h,d=f,g=s,l=c;;){h-=r,f-=o,s+=r,c+=o;var b=Math.floor(h),M=Math.floor(f),$=Math.ceil(s),m=Math.ceil(c);if($>g)for(var x=M;x<m;++x){var p=[$,x];if(n(p))return p}if(m>l)for(var B=$;B>b;--B){var W=[B,m];if(n(W))return W}if(b<v)for(var T=m;T>M;--T){var y=[b,T];if(n(y))return y}if(M<d)for(var S=b;S<$;++S){var w=[S,M];if(n(w))return w}v=b,d=M,g=$,l=m}}(this.O,[i,n],function(i){var n=i[0],o=i[1];return r.q(t,n,o)})};var f=4;return function(n,r,o,e){void 0===e&&(e={});var a=e.text;void 0===a&&(a="");var s=e.weight;void 0===s&&(s=1);var c=e.rotation;void 0===c&&(c=0);var v=e.rotationUnit;void 0===v&&(v="turn");var d=e.fontFamily;void 0===d&&(d="serif");var g=e.fontStyle;void 0===g&&(g="normal");var l=e.fontVariant;void 0===l&&(l="normal");var b=e.fontWeight;void 0===b&&(b="normal");var M=e.spacing;void 0===M&&(M=0);var $=e.fontSizeRatio;void 0===$&&($=0);var m=e.createCanvas;if(void 0===m&&(m=function(){return document.createElement("canvas")}),n.length>0&&r>0&&o>0){n=n.map(function(t){var i=t.text;void 0===i&&(i=a);var n=t.weight;void 0===n&&(n=s);var r=t.rotation;void 0===r&&(r=c);var o=t.rotationUnit;void 0===o&&(o=v);var e=t.fontFamily;void 0===e&&(e=d);var h=t.fontStyle;void 0===h&&(h=g);var f=t.fontVariant;void 0===f&&(f=l);var M=t.fontWeight;return void 0===M&&(M=b),new u(i,n,r,o,e,h,f,M,m)}),($=Math.abs($))>1&&($=1/$),n.sort(function(t,i){return i.i-t.i||i.M-t.M});var x=n[0].i,p=n[n.length-1].i;if(p<x){var B=$>0?1/$:p>0?x/p:x<0?p/x:1+x-p;n.forEach(function(t){var i,n,r;t.g*=(i=t.i,(r=1)+(i-(n=p))*(B-r)/(x-n))})}n.forEach(function(t){t.g*=f});var W=new h([r,o]);n.reduce(function(t,i){W.k(t.w,t.z,t.P),i.T=M;var n=W.A(i.w,i.z,i.P),r=n[0],o=n[1];return i.z=r,i.P=o,i.T=0,i});var T=t(n,function(t){return t.z}),y=i(n,function(t){return t.z+t.L}),S=t(n,function(t){return t.P}),w=i(n,function(t){return t.P+t.D}),L=Math.min(r/(y-T),o/(w-S)),D=(y+T)/2,H=(w+S)/2;return n.forEach(function(t){t.$-=D,t.m-=H,t.g*=L,t.$+=r/2,t.m+=o/2}),n=n.map(function(t){return{text:t.t,weight:t.i,rotationTurn:t.n,rotationDeg:t.v,rotationRad:t.d,fontStyle:t.o,fontVariant:t.u,fontWeight:t.e,fontSize:t.g,fontFamily:t.r,font:t.l,textWidth:t.M,boundingBoxWidth:t.x,boundingBoxHeight:t.p,boundingBoxLeft:t.B,boundingBoxTop:t.W,left:t.$,top:t.m}})}return[]}});
