!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(t.almete=t.almete||{},t.almete.WordCloud=r())}(this,function(){"use strict";function t(t,r){if(t.length>0)return r&&(t=t.map(r)),t.reduce(function(t,r){return Math.min(t,r)})}function r(t,r){if(t.length>0)return r&&(t=t.map(r)),t.reduce(function(t,r){return Math.max(t,r)})}function n(t,r,n){var e=t.text,i=t.rotationRad,o=t.font,a=t.rectWidth,f=t.rectHeight,h=n(),u=h.getContext("2d"),v=2+2*a,c=2+2*f;h.width=v,h.height=c,u.translate(v/2,c/2),u.rotate(i),u.font=o,u.textAlign="center",u.textBaseline="middle",u.fillText(e,0,0),r>0&&(u.miterLimit=1,u.lineWidth=2*r,u.strokeText(e,0,0));var d=u.getImageData(0,0,v,c).data;return[d=function(t,r,n){for(var e=new Uint8Array(r*n),i=0,o=t.length;i<o;++i)e[i]=t[4*i+3]?1:0;return e}(d,v,c),v,c]}function e(t){var r;return function(n,e,i){var o,a=function(t,r,n){for(var e=[],i=0;i<r;++i)for(var o=0;o<n;++o)t[r*o+i]&&e.push([i,o]);return e}(n,e,i),f=-Math.floor(e/2),h=-Math.floor(i/2);r?(o=function(t,r,n){var e,i,o=t[0],a=t[1],f=r[0],h=r[1];o>a?(e=1,i=a/o):a>o?(i=1,e=o/a):e=i=1;var u=[f,h];if(n(u))return u;for(var v=f,c=h,d=f,s=h,l=v,g=c;;){f-=e,h-=i,v+=e,c+=i;var m=Math.floor(f),M=Math.floor(h),x=Math.ceil(v),p=Math.ceil(c);if(x>l)for(var W=M;W<p;++W){var y=[x,W];if(n(y))return y}if(p>g)for(var w=x;w>m;--w){var S=[w,p];if(n(S))return S}if(m<d)for(var T=p;T>M;--T){var z=[m,T];if(n(z))return z}if(M<s)for(var R=m;R<x;++R){var b=[R,M];if(n(b))return b}d=m,s=M,l=x,g=p}}(t,[f,h],function(t){var n=t[0],e=t[1];return a.every(function(t){var i=t[0],o=t[1];return!r[n+i+"|"+(e+o)]})}),f=o[0],h=o[1]):r={};return a.forEach(function(t){var n=t[0],e=t[1];r[f+n+"|"+(h+e)]=!0}),[f,h]}}return function(i,o,a,f){void 0===f&&(f={});var h=f.text;void 0===h&&(h="");var u=f.weight;void 0===u&&(u=1);var v=f.rotation;void 0===v&&(v=0);var c=f.rotationUnit;void 0===c&&(c="turn");var d=f.fontFamily;void 0===d&&(d="serif");var s=f.fontStyle;void 0===s&&(s="normal");var l=f.fontVariant;void 0===l&&(l="normal");var g=f.fontWeight;void 0===g&&(g="normal");var m=f.spacing;void 0===m&&(m=0);var M=f.fontSizeRatio;void 0===M&&(M=0);var x=f.createCanvas;if(void 0===x&&(x=function(){return document.createElement("canvas")}),i.length>0&&o>0&&a>0){i=i.map(function(t){var r=t.text;void 0===r&&(r=h);var n=t.weight;void 0===n&&(n=u);var e=t.rotation;void 0===e&&(e=v);var i=t.rotationUnit;void 0===i&&(i=c);var o=t.fontFamily;void 0===o&&(o=d);var a=t.fontStyle;void 0===a&&(a=s);var f=t.fontVariant;void 0===f&&(f=l);var m=t.fontWeight;return void 0===m&&(m=g),{text:r,weight:n,rotationTurn:function(){switch(i){case"deg":return e/360;case"rad":return function(t){return t/2/Math.PI}(e)}return e}(),get rotationDeg(){return 360*this.rotationTurn},get rotationRad(){return 2*this.rotationTurn*Math.PI},fontFamily:o,fontStyle:a,fontVariant:f,fontWeight:m,get font(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize+"px",this.fontFamily].join(" ")},get rectWidth(){return Math.ceil(this.textWidth*Math.abs(Math.cos(this.rotationRad))+this.fontSize*Math.abs(Math.sin(this.rotationRad)))},get rectHeight(){return Math.ceil(this.textWidth*Math.abs(Math.sin(this.rotationRad))+this.fontSize*Math.abs(Math.cos(this.rotationRad)))},get rectLeft(){return this.left-this.rectWidth/2},get rectTop(){return this.top-this.rectHeight/2}}}),(M=Math.abs(M))>1&&(M=1/M),i.sort(function(t,r){return r.weight-t.weight});var p=i[0].weight,W=i[i.length-1].weight,y=W<p?M>0?1/M:W>0?p/W:p<0?W/p:1+p-W:1;1<y?i.forEach(function(t){var r,n,e;t.fontSize=(r=t.weight,(e=1)+(r-(n=W))*(y-e)/(p-n))}):i.forEach(function(t){t.fontSize=1});var w=e([o,a]);i.forEach(function(t){t.textWidth=function(t,r){var n=t.text,e=t.font,i=r().getContext("2d");return i.font=e,i.measureText(n).width}(t,x);var r=n(t,m,x),e=r[0],i=r[1],o=r[2],a=w(e,i,o),f=a[0],h=a[1];t.left=f+i/2,t.top=h+o/2});var S=t(i,function(t){return t.rectLeft}),T=r(i,function(t){return t.rectLeft+t.rectWidth}),z=T-S,R=T+S,b=t(i,function(t){return t.rectTop}),E=r(i,function(t){return t.rectTop+t.rectHeight}),C=E-b,F=E+b,H=Math.min(o/z,a/C);return i.forEach(function(t){t.left-=R/2,t.top-=F/2,t.fontSize*=H,t.textWidth*=H,t.left*=H,t.top*=H,t.left+=o/2,t.top+=a/2}),i}return[]}});
