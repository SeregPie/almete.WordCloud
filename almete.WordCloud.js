!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t.almete=t.almete||{},t.almete.WordCloud=i())}(this,function(){"use strict";function t(t,i,n){return Math.ceil(t*Math.abs(Math.sin(n))+i*Math.abs(Math.cos(n)))}function i(t,i,n){return Math.ceil(t*Math.abs(Math.cos(n))+i*Math.abs(Math.sin(n)))}function n(t,i,n,r,o){return[t,i,n,r+"px",o].join(" ")}function r(t,i){return Math.ceil(t/i)*i}function o(t,i,n){var r=n().getContext("2d");return r.font=i,r.measureText(t).width}var u=4;var h=function(t,i,n,r,o,u,h){this.t=t,this.i=i,this.n=n,this.r=r,this.o=o,this.u=u,this.h=h,this.a=1,this.e=0,this.f=0,this.s=0},a={c:{configurable:!0},v:{configurable:!0},d:{configurable:!0},g:{configurable:!0},l:{configurable:!0},b:{configurable:!0},M:{configurable:!0},m:{configurable:!0},x:{configurable:!0},p:{configurable:!0},B:{configurable:!0},W:{configurable:!0},T:{configurable:!0},w:{configurable:!0},y:{configurable:!0},S:{configurable:!0},L:{configurable:!0},j:{configurable:!0},D:{configurable:!0},H:{configurable:!0},z:{configurable:!0}};a.c.get=function(){return 360*this.i},a.v.get=function(){return this.i*Math.PI*2},a.d.get=function(){return this.a},a.d.set=function(t){this.a!==t&&(this.a=t,this.O=void 0)},a.g.get=function(){return n(this.r,this.o,this.u,this.d,this.n)},a.l.get=function(){return void 0===this.R&&(this.R=o(this.t,n(this.r,this.o,this.u,1,this.n),this.h)),this.R},a.b.get=function(){return this.l*this.d},a.M.get=function(){return this.f*this.d},a.M.set=function(t){this.f=t/this.d},a.m.get=function(){return this.s*this.d},a.m.set=function(t){this.s=t/this.d},a.x.get=function(){return i(this.b,this.d,this.v)},a.p.get=function(){return t(this.b,this.d,this.v)},a.B.get=function(){return this.M-this.x/2},a.W.get=function(){return this.m-this.p/2},a.T.get=function(){return this.e},a.T.set=function(t){this.e!==t&&(this.e=t,this.O=void 0)},a.w.get=function(){return void 0===this.O&&(this.O=function(h,a,e,f,s,c,v,d,g){var l=n(a,e,f,s*=u,c),b=o(h,l,g),M=v*s*2,m=g(),x=m.getContext("2d"),p=r(i(M+2*s+b,M+3*s,d),u),B=r(t(M+2*s+b,M+3*s,d),u);m.width=p,m.height=B,x.translate(p/2,B/2),x.rotate(d),x.font=l,x.textAlign="center",x.textBaseline="middle",x.fillText(h,0,0),M>0&&(x.miterLimit=1,x.lineWidth=M,x.strokeText(h,0,0));for(var W=x.getImageData(0,0,p,B).data,T=[],w=1/0,y=0,S=1/0,L=0,j=p/u,D=B/u,H=0;H<j;++H)for(var z=0;z<D;++z)t:for(var O=0;O<u;++O)for(var R=0;R<u;++R)if(W[4*(p*(z*u+R)+(H*u+O))+3]){T.push([H,z]),w=Math.min(H,w),y=Math.max(H+1,y),S=Math.min(z,S),L=Math.max(z+1,L);break t}return T.length>0?[T.map(function(t){var i=t[0],n=t[1];return[i-w,n-S]}),y-w,L-S,Math.ceil(j/2)-w,Math.ceil(D/2)-S]:[T,0,0,0,0]}(this.t,this.r,this.o,this.u,this.d,this.n,this.T,this.v,this.h)),this.O},a.y.get=function(){return this.w[0]},a.S.get=function(){return this.w[1]},a.L.get=function(){return this.w[2]},a.j.get=function(){return this.w[3]},a.D.get=function(){return this.w[4]},a.H.get=function(){return Math.ceil(this.M)-this.j},a.H.set=function(t){this.M=t+this.j},a.z.get=function(){return Math.ceil(this.m)-this.D},a.z.set=function(t){this.m=t+this.D},Object.defineProperties(h.prototype,a);var e=function(t){this.k=t,this.F()},f={M:{configurable:!0},m:{configurable:!0},P:{configurable:!0},V:{configurable:!0}};f.M.get=function(){return Math.ceil((this.q+this.A)/2)},f.m.get=function(){return Math.ceil((this.C+this.G)/2)},f.P.get=function(){return this.A-this.q},f.V.get=function(){return this.G-this.C},e.prototype.I=function(t,i,n){var r=this;t.forEach(function(t){var o=t[0],u=t[1],h=i+o,a=n+u;r.J[h+"|"+a]=!0,r.q=Math.min(h,r.q),r.A=Math.max(h+1,r.A),r.C=Math.min(a,r.C),r.G=Math.max(a+1,r.G)})},e.prototype.K=function(t,i,n){var r=this;return t.every(function(t){var o=t[0],u=t[1],h=i+o,a=n+u;return!r.J[h+"|"+a]})},e.prototype.N=function(t,i,n){var r=this;return function(t,i,n){var r,o,u=t[0],h=t[1],a=i[0],e=i[1];u>h?(r=1,o=h/u):h>u?(o=1,r=u/h):r=o=1;var f=[a,e];if(n(f))return f;for(var s=a,c=e,v=a,d=e,g=s,l=c;;){a-=r,e-=o,s+=r,c+=o;var b=Math.floor(a),M=Math.floor(e),m=Math.ceil(s),x=Math.ceil(c);if(m>g)for(var p=M;p<x;++p){var B=[m,p];if(n(B))return B}if(x>l)for(var W=m;W>b;--W){var T=[W,x];if(n(T))return T}if(b<v)for(var w=x;w>M;--w){var y=[b,w];if(n(y))return y}if(M<d)for(var S=b;S<m;++S){var L=[S,M];if(n(L))return L}v=b,d=M,g=m,l=x}}(this.k,[i+this.M,n+this.m],function(i){var n=i[0],o=i[1];return r.K(t,n,o)})},e.prototype.F=function(){this.J={},this.q=0,this.A=0,this.C=0,this.G=0},Object.defineProperties(e.prototype,f);var s=2,c=4;return function(t,i,n,r){void 0===r&&(r={});var o=r.text;void 0===o&&(o="");var u=r.weight;void 0===u&&(u=1);var a=r.rotation;void 0===a&&(a=0);var f=r.rotationUnit;void 0===f&&(f="turn");var v=r.fontFamily;void 0===v&&(v="serif");var d=r.fontStyle;void 0===d&&(d="normal");var g=r.fontVariant;void 0===g&&(g="normal");var l=r.fontWeight;void 0===l&&(l="normal");var b=r.spacing;void 0===b&&(b=0);var M=r.fontSizeRatio;void 0===M&&(M=0);var m=r.createCanvas;if(void 0===m&&(m=function(){return document.createElement("canvas")}),(M=Math.abs(M))>1&&(M=1/M),i>0&&n>0&&(t=t.map(function(t){var i=t.text;void 0===i&&(i=o);var n=t.weight;void 0===n&&(n=u);var r=t.rotation;void 0===r&&(r=a);var e=t.rotationUnit;void 0===e&&(e=f);var s=t.fontFamily;void 0===s&&(s=v);var c=t.fontStyle;void 0===c&&(c=d);var b=t.fontVariant;void 0===b&&(b=g);var M=t.fontWeight;void 0===M&&(M=l);var x=new h(i,function(){switch(e){case"deg":return r/360;case"rad":return function(t){return t/2/Math.PI}(r)}return r}(),s,c,b,M,m);return x.Q=n,x}).filter(function(t){return t.b>0}).sort(function(t,i){return i.Q-t.Q})).length>0){var x=t[0],p=function(t){return t[t.length-1]}(t),B=x.Q,W=p.Q;if(W<B){var T=M>0?1/M:W>0?B/W:B<0?W/B:1+B-W;t.forEach(function(t){var i,n,r;t.d=(i=t.Q,(r=1)+(i-(n=W))*(T-r)/(B-n))})}t.reduceRight(function(t,i){return i.d<s*t?i.d/=t:(t=i.d,i.d=1),i.U=t},1),t.forEach(function(t){t.d*=c});var w=new e([i,n]);if(t.reduce(function(i,n,r){if(n.U<i.U){w.F();var o=i.U/n.U;t.slice(0,r).forEach(function(t){t.d*=o,w.I(t.y,t.H,t.z)})}else w.I(i.y,i.H,i.z);n.T=b;var u=w.N(n.y,n.H,n.z),h=u[0],a=u[1];return n.H=h,n.z=a,n.T=0,n}),w.I(p.y,p.H,p.z),w.P>0&&w.V>0){var y=Math.min(i/w.P,n/w.V);t.forEach(function(t){t.M-=w.M,t.m-=w.m,t.d*=y,t.M+=i/2,t.m+=n/2})}return t.map(function(t){return{text:t.t,weight:t.Q,rotationTurn:t.i,rotationDeg:t.c,rotationRad:t.v,fontStyle:t.r,fontVariant:t.o,fontWeight:t.u,fontSize:t.d,fontFamily:t.n,font:t.g,textWidth:t.b,boundingBoxWidth:t.x,boundingBoxHeight:t.p,boundingBoxLeft:t.B,boundingBoxTop:t.W,left:t.M,top:t.m}})}return[]}});
