!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t.almete=t.almete||{},t.almete.WordCloud=n())}(this,function(){"use strict";function t(t,n){if(t.length>0)return n&&(t=t.map(n)),t.reduce(function(t,n){return Math.min(t,n)})}function n(t,n){if(t.length>0)return n&&(t=t.map(n)),t.reduce(function(t,n){return Math.max(t,n)})}function e(t,n,e,r,i){return r+(t-n)*(i-r)/(e-n)}function r(t,n,e,r,i,o,a,f){a=2*a*Math.PI;var u=[n,e,r,i+"px",o].join(" "),c=f(),h=c.getContext("2d");h.font=u;var v=h.measureText(t).width,d=Math.max(h.measureText("m").width,i),l=function(t,n,e){return[Math.ceil(t*Math.abs(Math.cos(e))+n*Math.abs(Math.sin(e))),Math.ceil(t*Math.abs(Math.sin(e))+n*Math.abs(Math.cos(e)))]}(v,i,a),m=l[0],g=l[1],s=m+4*d,p=g+4*d;c.width=s,c.height=p,h.translate(s/2,p/2),h.rotate(a),h.font=u,h.textAlign="center",h.textBaseline="middle",h.fillText(t,0,0);var x=h.getImageData(0,0,s,p).data;return[v,m,g,x=function(t,n,e){for(var r=new Uint8Array(n*e),i=0,o=t.length;i<o;++i)r[i]=t[4*i+3]?1:0;return r}(x,s,p),s,p]}return function(i,o,a,f){void 0===f&&(f={});var u=f.text;void 0===u&&(u="");var c=f.weight;void 0===c&&(c=1);var h=f.rotation;void 0===h&&(h=0);var v=f.fontFamily;void 0===v&&(v="serif");var d=f.fontStyle;void 0===d&&(d="normal");var l=f.fontVariant;void 0===l&&(l="normal");var m=f.fontWeight;void 0===m&&(m="normal");var g=f.fontSizeRatio;void 0===g&&(g=0);var s,p=f.createCanvas;if(void 0===p&&(p=function(){return document.createElement("canvas")}),i.length>0&&o>0&&a>0){i=function(t,n,e,r,i,o,a,f){return t.map(function(t){var u=t.text;void 0===u&&(u=n);var c=t.weight;void 0===c&&(c=e);var h=t.rotation;void 0===h&&(h=r);var v=t.fontFamily;void 0===v&&(v=i);var d=t.fontStyle;void 0===d&&(d=o);var l=t.fontVariant;void 0===l&&(l=a);var m=t.fontWeight;return void 0===m&&(m=f),{text:u,weight:c,rotation:h,fontFamily:v,fontStyle:d,fontVariant:l,fontWeight:m}})}(i,u,c,h,v,d,l,m),s=function(t){return-t.weight};var x=function(r,i){var o=t(r,function(t){return t.weight}),a=n(r,function(t){return t.weight});if(o<a&&i>0&&i<1/0)return i<1&&(i=1/i),r.map(function(t){return e(t.weight,o,a,1,i)});if(o>0)return r.map(function(t){return t.weight/o});var f=1+Math.abs(o)+Math.abs(a);return r.map(function(t){return e(t.weight,o,a,1,f)})}(i=i.map(function(t){return[s(t),t]}).sort(function(t,n){var e=t[0],r=n[0];return e>r?1:e<r?-1:0}).map(function(t){return t[1]}),g),M=function(t,n,e){return[-n/2,-e/2]},w=i.map(function(t,n){var e=t.text,i=(t.weight,t.rotation),o=t.fontFamily,a=t.fontStyle,f=t.fontVariant,u=t.fontWeight,c=x[n],h=r(e,a,f,u,c,o,i,p),v=h[0],d=h[1],l=h[2],m=h[3],g=h[4],s=h[5],w=M(m,g,s);return{text:e,rotation:i,fontStyle:a,fontVariant:f,fontWeight:u,fontSize:c,fontFamily:o,textWidth:v,rectWidth:d,rectHeight:l,left:w[0]+g/2,top:w[1]+s/2}});return function(e,r,i){var o=t(e,function(t){return t.left-t.rectWidth/2}),a=n(e,function(t){return t.left+t.rectWidth/2})-o,f=t(e,function(t){return t.top-t.rectHeight/2}),u=n(e,function(t){return t.top+t.rectHeight/2})-f,c=Math.min(r/a,i/u);e.forEach(function(t){t.fontSize*=c,t.textWidth*=c,t.textHeight*=c,t.rectWidth*=c,t.rectHeight*=c,t.left*=c,t.top*=c})}(w,o,a),function(t,n,e){t.forEach(function(t){t.left+=n/2,t.top+=e/2})}(w,o,a),w}return[]}});
