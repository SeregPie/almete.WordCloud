!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t.almete=t.almete||{},t.almete.WordCloud=i())}(this,function(){"use strict";function t(t,i){if(t.length>0)return i&&(t=t.map(i)),t.reduce(function(t,i){return Math.min(t,i)})}function i(t,i){if(t.length>0)return i&&(t=t.map(i)),t.reduce(function(t,i){return Math.max(t,i)})}function n(t,i,n){return Math.ceil(t*Math.abs(Math.sin(n))+i*Math.abs(Math.cos(n)))}function r(t,i,n){return Math.ceil(t*Math.abs(Math.cos(n))+i*Math.abs(Math.sin(n)))}function o(t,i){return Math.ceil(t/i)*i}function u(t,i,n,r,o){return[t,i,n,r+"px",o].join(" ")}var h=function(t,i,n,r,o,u,h,e,a){this.t=t,this.i=i,this.n=function(){switch(r){case"deg":return n/360;case"rad":return function(t){return t/2/Math.PI}(n)}return n}(),this.r=o,this.o=u,this.u=h,this.h=e,this.e=0,this.a=0,this.f=a,this.s=0,this.c=1},e={v:{configurable:!0},d:{configurable:!0},g:{configurable:!0},l:{configurable:!0},b:{configurable:!0},M:{configurable:!0},$:{configurable:!0},m:{configurable:!0},x:{configurable:!0},p:{configurable:!0},B:{configurable:!0},W:{configurable:!0},T:{configurable:!0},y:{configurable:!0},S:{configurable:!0},L:{configurable:!0},w:{configurable:!0},D:{configurable:!0},H:{configurable:!0},j:{configurable:!0},z:{configurable:!0},F:{configurable:!0},P:{configurable:!0}};e.v.get=function(){return 360*this.n},e.d.get=function(){return this.n*Math.PI*2},e.g.get=function(){return this.c},e.g.set=function(t){this.c!==t&&(this.c=t,this.R=void 0)},e.l.get=function(){return Math.ceil(this.c)},e.b.get=function(){return u(this.o,this.u,this.h,this.l,this.r)},e.M.get=function(){var t,i,n,r;return void 0===this.O&&(this.O=(t=this.t,i=u(this.o,this.u,this.h,1,this.r),n=this.f,(r=n().getContext("2d")).font=i,r.measureText(t).width)),this.O},e.$.get=function(){return Math.ceil(this.M*this.g)},e.m.get=function(){return Math.ceil(this.e*this.g)},e.m.set=function(t){this.e=t/this.g},e.x.get=function(){return Math.ceil(this.a*this.g)},e.x.set=function(t){this.a=t/this.g},e.p.get=function(){return r(this.$,this.l,this.d)},e.B.get=function(){return n(this.$,this.l,this.d)},e.W.get=function(){return Math.ceil(this.m-this.p/2)},e.T.get=function(){return Math.ceil(this.x-this.B/2)},e.y.get=function(){return this.s},e.y.set=function(t){this.s!==t&&(this.s=t,this.R=void 0)},e.S.get=function(){return Math.ceil(this.y*this.g)},e.L.get=function(){return void 0===this.R&&(this.R=function(t,i,n,r,o,u,h){var e=h(),a=e.getContext("2d");e.width=o,e.height=u,a.translate(o/2,u/2),a.rotate(r),a.font=i,a.textAlign="center",a.textBaseline="middle",a.fillText(t,0,0),n>0&&(a.miterLimit=1,a.lineWidth=n,a.strokeText(t,0,0));for(var f=a.getImageData(0,0,o,u).data,s=[],c=0;c<o;++c)for(var v=0;v<u;++v)f[4*(o*v+c)+3]&&s.push([c,v]);return[s,o,u,o/2,u/2]}(this.t,this.b,2*this.S,this.d,o(r(this.$+2*(this.S+this.l),this.l+2*(this.S+this.l),this.d),2),o(n(this.$+2*(this.S+this.l),this.l+2*(this.S+this.l),this.d),2),this.f)),this.R},e.w.get=function(){return this.L[0]},e.D.get=function(){return this.L[1]},e.H.get=function(){return this.L[2]},e.j.get=function(){return this.L[3]},e.z.get=function(){return this.L[4]},e.F.get=function(){return this.m-this.j},e.F.set=function(t){this.m=t+this.j},e.P.get=function(){return this.x-this.z},e.P.set=function(t){this.x=t+this.z},Object.defineProperties(h.prototype,e);var a=function(t){this.V=t,this.k={}};a.prototype.q=function(t,i,n){var r=this;t.forEach(function(t){var o=t[0],u=t[1],h=i+o,e=n+u;r.k[h+"|"+e]=!0})},a.prototype.A=function(t,i,n){var r=this;return t.every(function(t){var o=t[0],u=t[1],h=i+o,e=n+u;return!r.k[h+"|"+e]})},a.prototype.C=function(t,i,n){var r=this;return function(t,i,n){var r,o,u=t[0],h=t[1],e=i[0],a=i[1];u>h?(r=1,o=h/u):h>u?(o=1,r=u/h):r=o=1;var f=[e,a];if(n(f))return f;for(var s=e,c=a,v=e,d=a,g=s,l=c;;){e-=r,a-=o,s+=r,c+=o;var b=Math.floor(e),M=Math.floor(a),$=Math.ceil(s),m=Math.ceil(c);if($>g)for(var x=M;x<m;++x){var p=[$,x];if(n(p))return p}if(m>l)for(var B=$;B>b;--B){var W=[B,m];if(n(W))return W}if(b<v)for(var T=m;T>M;--T){var y=[b,T];if(n(y))return y}if(M<d)for(var S=b;S<$;++S){var L=[S,M];if(n(L))return L}v=b,d=M,g=$,l=m}}(this.V,[i,n],function(i){var n=i[0],o=i[1];return r.A(t,n,o)})};var f=4;return function(n,r,o,u){void 0===u&&(u={});var e=u.text;void 0===e&&(e="");var s=u.weight;void 0===s&&(s=1);var c=u.rotation;void 0===c&&(c=0);var v=u.rotationUnit;void 0===v&&(v="turn");var d=u.fontFamily;void 0===d&&(d="serif");var g=u.fontStyle;void 0===g&&(g="normal");var l=u.fontVariant;void 0===l&&(l="normal");var b=u.fontWeight;void 0===b&&(b="normal");var M=u.spacing;void 0===M&&(M=0);var $=u.fontSizeRatio;void 0===$&&($=0);var m=u.createCanvas;if(void 0===m&&(m=function(){return document.createElement("canvas")}),n.length>0&&r>0&&o>0){n=n.map(function(t){var i=t.text;void 0===i&&(i=e);var n=t.weight;void 0===n&&(n=s);var r=t.rotation;void 0===r&&(r=c);var o=t.rotationUnit;void 0===o&&(o=v);var u=t.fontFamily;void 0===u&&(u=d);var a=t.fontStyle;void 0===a&&(a=g);var f=t.fontVariant;void 0===f&&(f=l);var M=t.fontWeight;return void 0===M&&(M=b),new h(i,n,r,o,u,a,f,M,m)}),($=Math.abs($))>1&&($=1/$),n.sort(function(t,i){return i.i-t.i||i.$-t.$});var x=n[0].i,p=n[n.length-1].i;if(p<x){var B=$>0?1/$:p>0?x/p:x<0?p/x:1+x-p;n.forEach(function(t){var i,n,r;t.g*=(i=t.i,(r=1)+(i-(n=p))*(B-r)/(x-n))})}n.forEach(function(t){t.g*=f});var W=new a([r,o]);n.reduce(function(t,i){W.q(t.w,t.F,t.P),i.y=M;var n=W.C(i.w,i.F,i.P),r=n[0],o=n[1];return i.F=r,i.P=o,i.y=0,i});var T=t(n,function(t){return t.W}),y=i(n,function(t){return t.W+t.p}),S=y-T,L=y+T,w=t(n,function(t){return t.T}),D=i(n,function(t){return t.T+t.B}),H=D-w,j=D+w,z=Math.min(r/S,o/H);return n.forEach(function(t){t.m-=L/2,t.x-=j/2,t.g*=z,t.m+=r/2,t.x+=o/2}),n=n.map(function(t){return{text:t.t,rotationTurn:t.n,rotationDeg:t.v,rotationRad:t.d,fontStyle:t.o,fontVariant:t.u,fontWeight:t.h,fontSize:t.l,fontFamily:t.r,font:t.b,textWidth:t.$,boundingBoxWidth:t.p,boundingBoxHeight:t.B,boundingBoxLeft:t.W,boundingBoxTop:t.T,left:t.m,top:t.x}})}return[]}});
