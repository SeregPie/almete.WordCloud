!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(t.almete=t.almete||{},t.almete.WordCloud=r())}(this,function(){"use strict";function t(t,r){if(t.length>0)return r&&(t=t.map(r)),t.reduce(function(t,r){return Math.min(t,r)})}function r(t,r){if(t.length>0)return r&&(t=t.map(r)),t.reduce(function(t,r){return Math.max(t,r)})}function n(t,r){switch(r){case"deg":return t/360;case"rad":return function(t){return t/2/Math.PI}(t)}return t}function e(t,r,n){var e=t.text,i=t.rotationRad,o=t.font,a=t.rectWidth,f=t.rectHeight,h=n(),u=h.getContext("2d"),v=2+2*a,c=2+2*f;h.width=v,h.height=c,u.translate(v/2,c/2),u.rotate(i),u.font=o,u.textAlign="center",u.textBaseline="middle",u.fillText(e,0,0),r>0&&(u.miterLimit=1,u.lineWidth=2*r,u.strokeText(e,0,0));var d=u.getImageData(0,0,v,c).data;return[d=function(t,r,n){for(var e=new Uint8Array(r*n),i=0,o=t.length;i<o;++i)e[i]=t[4*i+3]?1:0;return e}(d,v,c),v,c]}function i(t){var r;return function(n,e,i){var o,a=function(t,r,n){for(var e=[],i=0;i<r;++i)for(var o=0;o<n;++o)t[r*o+i]&&e.push([i,o]);return e}(n,e,i),f=-Math.floor(e/2),h=-Math.floor(i/2);r?(o=function(t,r,n){var e,i,o=t[0],a=t[1],f=r[0],h=r[1];o>a?(e=1,i=a/o):a>o?(i=1,e=o/a):e=i=1;var u=[f,h];if(n(u))return u;for(var v=f,c=h,d=f,s=h,l=v,g=c;;){f-=e,h-=i,v+=e,c+=i;var m=Math.floor(f),M=Math.floor(h),x=Math.ceil(v),p=Math.ceil(c);if(x>l)for(var W=M;W<p;++W){var y=[x,W];if(n(y))return y}if(p>g)for(var w=x;w>m;--w){var S=[w,p];if(n(S))return S}if(m<d)for(var T=p;T>M;--T){var z=[m,T];if(n(z))return z}if(M<s)for(var R=m;R<x;++R){var b=[R,M];if(n(b))return b}d=m,s=M,l=x,g=p}}(t,[f,h],function(t){var n=t[0],e=t[1];return a.every(function(t){var i=t[0],o=t[1];return!r[n+i+"|"+(e+o)]})}),f=o[0],h=o[1]):r={};return a.forEach(function(t){var n=t[0],e=t[1];r[f+n+"|"+(h+e)]=!0}),[f,h]}}return function(o,a,f,h){void 0===h&&(h={});var u=h.text;void 0===u&&(u="");var v=h.weight;void 0===v&&(v=1);var c=h.rotation;void 0===c&&(c=0);var d=h.rotationUnit;void 0===d&&(d="turn");var s=h.fontFamily;void 0===s&&(s="serif");var l=h.fontStyle;void 0===l&&(l="normal");var g=h.fontVariant;void 0===g&&(g="normal");var m=h.fontWeight;void 0===m&&(m="normal");var M=h.spacing;void 0===M&&(M=0);var x=h.fontSizeRatio;void 0===x&&(x=0);var p=h.createCanvas;if(void 0===p&&(p=function(){return document.createElement("canvas")}),o.length>0&&a>0&&f>0){o=o.map(function(t){var r=t.text;void 0===r&&(r=u);var e=t.weight;void 0===e&&(e=v);var i=t.rotation;void 0===i&&(i=c);var o=t.rotationUnit;void 0===o&&(o=d);var a=t.fontFamily;void 0===a&&(a=s);var f=t.fontStyle;void 0===f&&(f=l);var h=t.fontVariant;void 0===h&&(h=g);var M=t.fontWeight;return void 0===M&&(M=m),{text:r,weight:e,rotationTurn:n(i,o),get rotationDeg(){return 360*this.rotationTurn},get rotationRad(){return 2*this.rotationTurn*Math.PI},fontFamily:a,fontStyle:f,fontVariant:h,fontWeight:M,get font(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize+"px",this.fontFamily].join(" ")},get rectWidth(){return Math.ceil(this.textWidth*Math.abs(Math.cos(this.rotationRad))+this.fontSize*Math.abs(Math.sin(this.rotationRad)))},get rectHeight(){return Math.ceil(this.textWidth*Math.abs(Math.sin(this.rotationRad))+this.fontSize*Math.abs(Math.cos(this.rotationRad)))},get rectLeft(){return this.left-this.rectWidth/2},get rectTop(){return this.top-this.rectHeight/2}}}),(x=Math.abs(x))>1&&(x=1/x),o.sort(function(t,r){return r.weight-t.weight});var W=o[0].weight,y=o[o.length-1].weight,w=y<W?x>0?1/x:y>0?W/y:W<0?y/W:1+W-y:1;1<w?o.forEach(function(t){var r,n,e;t.fontSize=(r=t.weight,(e=1)+(r-(n=y))*(w-e)/(W-n))}):o.forEach(function(t){t.fontSize=1});var S=i([a,f]);o.forEach(function(t){t.textWidth=function(t,r){var n=t.text,e=t.font,i=r().getContext("2d");return i.font=e,i.measureText(n).width}(t,p);var r=e(t,M,p),n=r[0],i=r[1],o=r[2],a=S(n,i,o),f=a[0],h=a[1];t.left=f+i/2,t.top=h+o/2});var T=t(o,function(t){return t.rectLeft}),z=r(o,function(t){return t.rectLeft+t.rectWidth}),R=z-T,b=z+T,E=t(o,function(t){return t.rectTop}),C=r(o,function(t){return t.rectTop+t.rectHeight}),F=C-E,H=C+E,L=Math.min(a/R,f/F);return o.forEach(function(t){t.left-=b/2,t.top-=H/2,t.fontSize*=L,t.textWidth*=L,t.left*=L,t.top*=L,t.left+=a/2,t.top+=f/2}),o}return[]}});
