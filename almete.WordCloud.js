!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t.almete=t.almete||{},t.almete.WordCloud=i())}(this,function(){"use strict";function t(t,i){if(t.length>0)return i&&(t=t.map(i)),t.reduce(function(t,i){return Math.max(t,i)})}function i(t,i){if(t.length>0)return i&&(t=t.map(i)),t.reduce(function(t,i){return Math.min(t,i)})}function n(t,i,n){return Math.ceil(t*Math.abs(Math.sin(n))+i*Math.abs(Math.cos(n)))}function r(t,i,n){return Math.ceil(t*Math.abs(Math.cos(n))+i*Math.abs(Math.sin(n)))}var o=function(t,i,n,r,o,u,e,h){this.t=t,this.i=i,this.n=n,this.r=r,this.o=o,this.u=u,this.e=e,this.h=h,this.a=1,this.f=0,this.s=0,this.c=0},u={v:{configurable:!0},d:{configurable:!0},g:{configurable:!0},l:{configurable:!0},b:{configurable:!0},M:{configurable:!0},$:{configurable:!0},x:{configurable:!0},m:{configurable:!0},p:{configurable:!0},B:{configurable:!0},T:{configurable:!0},W:{configurable:!0},w:{configurable:!0},y:{configurable:!0},L:{configurable:!0},S:{configurable:!0},j:{configurable:!0},D:{configurable:!0},H:{configurable:!0},z:{configurable:!0},O:{configurable:!0}};u.v.get=function(){return 360*this.n},u.d.get=function(){return this.n*Math.PI*2},u.g.get=function(){return this.a},u.g.set=function(t){this.a!==t&&(this.a=t,this.P=void 0)},u.l.get=function(){return t=this.o,i=this.u,n=this.e,r=this.g,o=this.r,[t,i,n,r+"px",o].join(" ");var t,i,n,r,o},u.b.get=function(){var t,i,n,r;return void 0===this.R&&(this.R=(t=this.t,i=this.l,n=this.h,(r=n().getContext("2d")).font=i,r.measureText(t).width/this.g)),this.R},u.M.get=function(){return this.b*this.g},u.$.get=function(){return this.s*this.g},u.$.set=function(t){this.s=t/this.g},u.x.get=function(){return this.c*this.g},u.x.set=function(t){this.c=t/this.g},u.m.get=function(){return r(this.M,this.g,this.d)},u.p.get=function(){return n(this.M,this.g,this.d)},u.B.get=function(){return this.$-this.m/2},u.T.get=function(){return this.x-this.p/2},u.W.get=function(){return this.f},u.W.set=function(t){this.f!==t&&(this.f=t,this.P=void 0)},u.w.get=function(){return this.W*this.g},u.y.get=function(){return void 0===this.P&&(this.P=function(n,r,o,u,e,h,a){var f=a(),s=f.getContext("2d");f.width=e,f.height=h,s.translate(e/2,h/2),s.rotate(u),s.font=r,s.textAlign="center",s.textBaseline="middle",s.fillText(n,0,0),o>0&&(s.miterLimit=1,s.lineWidth=o,s.strokeText(n,0,0));for(var c=s.getImageData(0,0,e,h).data,v=[],d=0;d<e;++d)for(var g=0;g<h;++g)c[4*(e*g+d)+3]&&v.push([d,g]);if(v.length<1)return[v,0,0,0,0];var l=i(v,function(t){return t[0]}),b=t(v,function(t){return t[0]})+1,M=i(v,function(t){return t[1]}),$=t(v,function(t){return t[1]})+1;return[v.map(function(t){var i=t[0],n=t[1];return[i-l,n-M]}),b-l,$-M,Math.ceil(e/2)-l,Math.ceil(h/2)-M]}(this.t,this.l,2*this.w,this.d,r(this.M+2*(this.w+this.g),this.g+2*(this.w+this.g),this.d),n(this.M+2*(this.w+this.g),this.g+2*(this.w+this.g),this.d),this.h)),this.P},u.L.get=function(){return this.y[0]},u.S.get=function(){return this.y[1]},u.j.get=function(){return this.y[2]},u.D.get=function(){return this.y[3]},u.H.get=function(){return this.y[4]},u.z.get=function(){return Math.ceil(this.$)-this.D},u.z.set=function(t){this.$=t+this.D},u.O.get=function(){return Math.ceil(this.x)-this.H},u.O.set=function(t){this.x=t+this.H},Object.defineProperties(o.prototype,u);var e=function(t){this.F=t,this.V={},this.k=0,this.q=0,this.A=0,this.C=0},h={G:{configurable:!0},I:{configurable:!0}};return e.prototype.J=function(t,i,n){var r=this;t.forEach(function(t){var o=t[0],u=t[1],e=i+o,h=n+u;r.V[e+"|"+h]=!0,r.k=Math.min(e,r.k),r.q=Math.max(e,r.q),r.A=Math.min(h,r.A),r.C=Math.max(h,r.C)})},e.prototype.K=function(t,i,n){var r=this;return t.every(function(t){var o=t[0],u=t[1],e=i+o,h=n+u;return!r.V[e+"|"+h]})},h.G.get=function(){return Math.ceil((this.q+this.k)/2)},h.I.get=function(){return Math.ceil((this.C+this.A)/2)},e.prototype.N=function(t,i,n){var r=this;return function(t,i,n){var r,o,u=t[0],e=t[1],h=i[0],a=i[1];u>e?(r=1,o=e/u):e>u?(o=1,r=u/e):r=o=1;var f=[h,a];if(n(f))return f;for(var s=h,c=a,v=h,d=a,g=s,l=c;;){h-=r,a-=o,s+=r,c+=o;var b=Math.floor(h),M=Math.floor(a),$=Math.ceil(s),x=Math.ceil(c);if($>g)for(var m=M;m<x;++m){var p=[$,m];if(n(p))return p}if(x>l)for(var B=$;B>b;--B){var T=[B,x];if(n(T))return T}if(b<v)for(var W=x;W>M;--W){var w=[b,W];if(n(w))return w}if(M<d)for(var y=b;y<$;++y){var L=[y,M];if(n(L))return L}v=b,d=M,g=$,l=x}}(this.F,[i+this.G,n+this.I],function(i){var n=i[0],o=i[1];return r.K(t,n,o)})},Object.defineProperties(e.prototype,h),function(n,r,u,h){void 0===h&&(h={});var a=h.text;void 0===a&&(a="");var f=h.weight;void 0===f&&(f=1);var s=h.rotation;void 0===s&&(s=0);var c=h.rotationUnit;void 0===c&&(c="turn");var v=h.fontFamily;void 0===v&&(v="serif");var d=h.fontStyle;void 0===d&&(d="normal");var g=h.fontVariant;void 0===g&&(g="normal");var l=h.fontWeight;void 0===l&&(l="normal");var b=h.spacing;void 0===b&&(b=0);var M=h.fontSizeRatio;void 0===M&&(M=0);var $=h.xxx;void 0===$&&($=6);var x=h.yyy;void 0===x&&(x=2);var m=h.createCanvas;if(void 0===m&&(m=function(){return document.createElement("canvas")}),(M=Math.abs(M))>1&&(M=1/M),n.length>0&&r>0&&u>0){(n=n.map(function(t){var i=t.text;void 0===i&&(i=a);var n=t.weight;void 0===n&&(n=f);var r=t.rotation;void 0===r&&(r=s);var u=t.rotationUnit;void 0===u&&(u=c);var e=t.fontFamily;void 0===e&&(e=v);var h=t.fontStyle;void 0===h&&(h=d);var b=t.fontVariant;void 0===b&&(b=g);var M=t.fontWeight;return void 0===M&&(M=l),new o(i,n,function(){switch(u){case"deg":return r/360;case"rad":return function(t){return t/2/Math.PI}(r)}return r}(),e,h,b,M,m)})).sort(function(t,i){return i.i-t.i||i.M-t.M});var p=n[0].i,B=n[n.length-1].i;if(B<p){var T=M>0?1/M:B>0?p/B:p<0?B/p:1+p-B;n.forEach(function(t){var i,n,r;t.g*=(i=t.i,(r=1)+(i-(n=B))*(T-r)/(p-n))})}var W=n[0],w=W.g/$;W.g=$;var y=new e([r,u]);n.reduce(function(t,i,o){var h=i.g/$;if(h*x>w)y.J(t.L,t.z,t.O);else{var a=w/h;y=new e([r,u]),n.slice(0,o).forEach(function(t){t.g*=a,y.J(t.L,t.z,t.O)}),w=h}i.g/=w,i.W=b;var f=y.N(i.L,i.z,i.O),s=f[0],c=f[1];return i.z=s,i.O=c,i.W=0,i});var L=i(n,function(t){return t.z}),S=t(n,function(t){return t.z+t.S}),j=i(n,function(t){return t.O}),D=t(n,function(t){return t.O+t.j}),H=S-L,z=D-j,O=(S+L)/2,P=(D+j)/2,R=Math.min(r/H,u/z);return n.forEach(function(t){t.$-=O,t.x-=P,t.g*=R,t.$+=r/2,t.x+=u/2}),n.map(function(t){return{text:t.t,weight:t.i,rotationTurn:t.n,rotationDeg:t.v,rotationRad:t.d,fontStyle:t.o,fontVariant:t.u,fontWeight:t.e,fontSize:t.g,fontFamily:t.r,font:t.l,textWidth:t.M,boundingBoxWidth:t.m,boundingBoxHeight:t.p,boundingBoxLeft:t.B,boundingBoxTop:t.T,left:t.$,top:t.x}})}return[]}});
