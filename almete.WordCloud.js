!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t.almete=t.almete||{},t.almete.WordCloud=i())}(this,function(){"use strict";function j(t,i,n){return Math.ceil(t*Math.abs(Math.sin(n))+i*Math.abs(Math.cos(n)))}function D(t,i,n){return Math.ceil(t*Math.abs(Math.cos(n))+i*Math.abs(Math.sin(n)))}function H(t,i,n,r,o){return[t,i,n,r+"px",o].join(" ")}function z(t,i){return Math.ceil(t/i)*i}function O(t,i,n){var r=n().getContext("2d");return r.font=i,r.measureText(t).width}var w=function(t,i,n,r,o,u,h){this.t=t,this.i=i,this.n=n,this.r=r,this.o=o,this.u=u,this.h=h,this.a=1,this.e=0,this.f=0,this.s=0},t={c:{configurable:!0},v:{configurable:!0},d:{configurable:!0},g:{configurable:!0},l:{configurable:!0},b:{configurable:!0},M:{configurable:!0},m:{configurable:!0},x:{configurable:!0},p:{configurable:!0},B:{configurable:!0},W:{configurable:!0},T:{configurable:!0},w:{configurable:!0},y:{configurable:!0},S:{configurable:!0},L:{configurable:!0},j:{configurable:!0},D:{configurable:!0},H:{configurable:!0},z:{configurable:!0}};t.c.get=function(){return 360*this.i},t.v.get=function(){return this.i*Math.PI*2},t.d.get=function(){return this.a},t.d.set=function(t){this.a!==t&&(this.a=t,this.O=void 0)},t.g.get=function(){return H(this.r,this.o,this.u,this.d,this.n)},t.l.get=function(){return void 0===this.R&&(this.R=O(this.t,H(this.r,this.o,this.u,1,this.n),this.h)),this.R},t.b.get=function(){return this.l*this.d},t.M.get=function(){return this.f*this.d},t.M.set=function(t){this.f=t/this.d},t.m.get=function(){return this.s*this.d},t.m.set=function(t){this.s=t/this.d},t.x.get=function(){return D(this.b,this.d,this.v)},t.p.get=function(){return j(this.b,this.d,this.v)},t.B.get=function(){return this.M-this.x/2},t.W.get=function(){return this.m-this.p/2},t.T.get=function(){return this.e},t.T.set=function(t){this.e!==t&&(this.e=t,this.O=void 0)},t.w.get=function(){return void 0===this.O&&(this.O=function(t,i,n,r,o,u,h,a,e){var f=H(i,n,r,o*=4,u),s=O(t,f,e),c=h*o*2,v=e(),d=v.getContext("2d"),g=z(D(c+2*o+s,c+3*o,a),4),l=z(j(c+2*o+s,c+3*o,a),4);v.width=g,v.height=l,d.translate(g/2,l/2),d.rotate(a),d.font=f,d.textAlign="center",d.textBaseline="middle",d.fillText(t,0,0),0<c&&(d.miterLimit=1,d.lineWidth=c,d.strokeText(t,0,0));for(var b=d.getImageData(0,0,g,l).data,M=[],m=1/0,x=0,p=1/0,B=0,W=g/4,T=l/4,w=0;w<W;++w)for(var y=0;y<T;++y)t:for(var S=0;S<4;++S)for(var L=0;L<4;++L)if(b[4*(g*(4*y+L)+(4*w+S))+3]){M.push([w,y]),m=Math.min(w,m),x=Math.max(w+1,x),p=Math.min(y,p),B=Math.max(y+1,B);break t}return 0<M.length?[M.map(function(t){var i=t[0],n=t[1];return[i-m,n-p]}),x-m,B-p,Math.ceil(W/2)-m,Math.ceil(T/2)-p]:[M,0,0,0,0]}(this.t,this.r,this.o,this.u,this.d,this.n,this.T,this.v,this.h)),this.O},t.y.get=function(){return this.w[0]},t.S.get=function(){return this.w[1]},t.L.get=function(){return this.w[2]},t.j.get=function(){return this.w[3]},t.D.get=function(){return this.w[4]},t.H.get=function(){return Math.ceil(this.M)-this.j},t.H.set=function(t){this.M=t+this.j},t.z.get=function(){return Math.ceil(this.m)-this.D},t.z.set=function(t){this.m=t+this.D},Object.defineProperties(w.prototype,t);var y=function(t){this.k=t,this.F()},i={M:{configurable:!0},m:{configurable:!0},P:{configurable:!0},V:{configurable:!0}};i.M.get=function(){return Math.ceil((this.q+this.A)/2)},i.m.get=function(){return Math.ceil((this.C+this.G)/2)},i.P.get=function(){return this.A-this.q},i.V.get=function(){return this.G-this.C},y.prototype.I=function(t,u,h){var a=this;t.forEach(function(t){var i=t[0],n=t[1],r=u+i,o=h+n;a.J[r+"|"+o]=!0,a.q=Math.min(r,a.q),a.A=Math.max(r+1,a.A),a.C=Math.min(o,a.C),a.G=Math.max(o+1,a.G)})},y.prototype.K=function(t,u,h){var a=this;return t.every(function(t){var i=t[0],n=t[1],r=u+i,o=h+n;return!a.J[r+"|"+o]})},y.prototype.N=function(r,t,i){var o=this;return function(t,i,n){var r,o,u=t[0],h=t[1],a=i[0],e=i[1];h<u?(r=1,o=h/u):u<h?(o=1,r=u/h):r=o=1;var f=[a,e];if(n(f))return f;for(var s=a,c=e,v=a,d=e,g=s,l=c;;){a-=r,e-=o,s+=r,c+=o;var b=Math.floor(a),M=Math.floor(e),m=Math.ceil(s),x=Math.ceil(c);if(g<m)for(var p=M;p<x;++p){var B=[m,p];if(n(B))return B}if(l<x)for(var W=m;b<W;--W){var T=[W,x];if(n(T))return T}if(b<v)for(var w=x;M<w;--w){var y=[b,w];if(n(y))return y}if(M<d)for(var S=b;S<m;++S){var L=[S,M];if(n(L))return L}v=b,d=M,g=m,l=x}}(this.k,[t+this.M,i+this.m],function(t){var i=t[0],n=t[1];return o.K(r,i,n)})},y.prototype.F=function(){this.J={},this.q=0,this.A=0,this.C=0,this.G=0},Object.defineProperties(y.prototype,i);return function(a,i,n,t){void 0===t&&(t={});var s=t.text;void 0===s&&(s="");var c=t.weight;void 0===c&&(c=1);var v=t.rotation;void 0===v&&(v=0);var d=t.rotationUnit;void 0===d&&(d="turn");var g=t.fontFamily;void 0===g&&(g="serif");var l=t.fontStyle;void 0===l&&(l="normal");var b=t.fontVariant;void 0===b&&(b="normal");var M=t.fontWeight;void 0===M&&(M="normal");var e=t.spacing;void 0===e&&(e=0);var r=t.fontSizeRatio;void 0===r&&(r=0);var o,u,m=t.createCanvas;if(void 0===m&&(m=function(){return document.createElement("canvas")}),1<(r=Math.abs(r))&&(r=1/r),0<i&&0<n&&0<(a=a.map(function(t){var i=t.text;void 0===i&&(i=s);var n=t.weight;void 0===n&&(n=c);var r=t.rotation;void 0===r&&(r=v);var o=t.rotationUnit;void 0===o&&(o=d);var u=t.fontFamily;void 0===u&&(u=g);var h=t.fontStyle;void 0===h&&(h=l);var a=t.fontVariant;void 0===a&&(a=b);var e=t.fontWeight;void 0===e&&(e=M);var f=new w(i,function(){switch(o){case"deg":return r/360;case"rad":return r/2/Math.PI}return r}(),u,h,a,e,m);return f.Q=n,f}).filter(function(t){return 0<t.b}).sort(function(t,i){return i.Q-t.Q})).length){var h=a[0],f=(o=a)[(u=o,u.length-1)],x=h.Q,p=f.Q;if(p<x){var B=0<r?1/r:0<p?x/p:x<0?p/x:1+x-p;a.forEach(function(t){var i,n,r;t.d=(i=t.Q,(r=1)+(i-(n=p))*(B-r)/(x-n))})}a.reduceRight(function(t,i){return i.d<2*t?i.d/=t:(t=i.d,i.d=1),i.U=t},1),a.forEach(function(t){t.d*=4});var W=new y([i,n]);if(a.reduce(function(t,i,n){if(i.U<t.U){W.F();var r=t.U/i.U;a.slice(0,n).forEach(function(t){t.d*=r,W.I(t.y,t.H,t.z)})}else W.I(t.y,t.H,t.z);i.T=e;var o=W.N(i.y,i.H,i.z),u=o[0],h=o[1];return i.H=u,i.z=h,i.T=0,i}),W.I(f.y,f.H,f.z),0<W.P&&0<W.V){var T=Math.min(i/W.P,n/W.V);a.forEach(function(t){t.M-=W.M,t.m-=W.m,t.d*=T,t.M+=i/2,t.m+=n/2})}return a.map(function(t){return{text:t.t,weight:t.Q,rotationTurn:t.i,rotationDeg:t.c,rotationRad:t.v,fontStyle:t.r,fontVariant:t.o,fontWeight:t.u,fontSize:t.d,fontFamily:t.n,font:t.g,textWidth:t.b,boundingBoxWidth:t.x,boundingBoxHeight:t.p,boundingBoxLeft:t.B,boundingBoxTop:t.W,left:t.M,top:t.m}})}return[]}});
