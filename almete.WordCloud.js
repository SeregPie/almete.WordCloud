!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t.almete=t.almete||{},t.almete.WordCloud=n())}(this,function(){"use strict";function t(t,n){if(t.length>0)return n&&(t=t.map(n)),t.reduce(function(t,n){return Math.min(t,n)})}function n(t,n){if(t.length>0)return n&&(t=t.map(n)),t.reduce(function(t,n){return Math.max(t,n)})}function e(t,n,e,r,i){return r+(t-n)*(i-r)/(e-n)}function r(t,n,e,r,i,o,a){a=2*a*Math.PI;var f=[n,e,r,i+"px",o].join(" "),u=document.createElement("canvas").getContext("2d");u.font=f;var c=u.measureText(t).width,h=i,v=function(t,n,e){return[Math.ceil(t*Math.abs(Math.cos(e))+n*Math.abs(Math.sin(e))),Math.ceil(t*Math.abs(Math.sin(e))+n*Math.abs(Math.cos(e)))]}(c,h,a);return[c,h,v[0],v[1]]}return function(i,o,a,f){void 0===f&&(f={});var u=f.text;void 0===u&&(u="");var c=f.weight;void 0===c&&(c=1);var h=f.rotation;void 0===h&&(h=0);var v=f.fontFamily;void 0===v&&(v="serif");var d=f.fontStyle;void 0===d&&(d="normal");var m=f.fontVariant;void 0===m&&(m="normal");var l=f.fontWeight;void 0===l&&(l="normal");var g,p=f.fontSizeRatio;if(void 0===p&&(p=0),i.length>0&&o>0&&a>0){i=function(t,n,e,r,i,o,a,f){return t.map(function(t){var u=t.text;void 0===u&&(u=n);var c=t.weight;void 0===c&&(c=e);var h=t.rotation;void 0===h&&(h=r);var v=t.fontFamily;void 0===v&&(v=i);var d=t.fontStyle;void 0===d&&(d=o);var m=t.fontVariant;void 0===m&&(m=a);var l=t.fontWeight;return void 0===l&&(l=f),{text:u,weight:c,rotation:h,fontFamily:v,fontStyle:d,fontVariant:m,fontWeight:l}})}(i,u,c,h,v,d,m,l),g=function(t){return-t.weight};var s=function(r,i){var o=t(r,function(t){return t.weight}),a=n(r,function(t){return t.weight});if(o<a&&i>0&&i<1/0)return i<1&&(i=1/i),r.map(function(t){return e(t.weight,o,a,1,i)});if(o>0)return r.map(function(t){return t.weight/o});var f=1+Math.abs(o)+Math.abs(a);return r.map(function(t){return e(t.weight,o,a,1,f)})}(i=i.map(function(t){return[g(t),t]}).sort(function(t,n){var e=t[0],r=n[0];return e>r?1:e<r?-1:0}).map(function(t){return t[1]}),p),M=i.map(function(t,n){var e=t.text,i=(t.weight,t.rotation),o=t.fontFamily,a=t.fontStyle,f=t.fontVariant,u=t.fontWeight,c=s[n],h=r(e,a,f,u,c,o,i),v=h[0],d=h[2],m=h[3];return{text:e,rotation:i,fontStyle:a,fontVariant:f,fontWeight:u,fontSize:c,fontFamily:o,textWidth:v,rectWidth:d,rectHeight:m,rectLeft:-d/2,rectTop:-m/2}});return function(e,r,i){var o=t(e,function(t){return t.rectLeft}),a=n(e,function(t){return t.rectLeft+t.rectWidth})-o,f=t(e,function(t){return t.rectTop}),u=n(e,function(t){return t.rectTop+t.rectHeight})-f,c=Math.min(r/a,i/u);e.forEach(function(t){t.fontSize*=c,t.textWidth*=c,t.textHeight*=c,t.rectWidth*=c,t.rectHeight*=c,t.rectLeft*=c,t.rectTop*=c})}(M,o,a),function(t,n,e){t.forEach(function(t){t.rectLeft+=n/2,t.rectTop+=e/2})}(M,o,a),M}return[]}});
