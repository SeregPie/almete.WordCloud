!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t.almete=t.almete||{},t.almete.WordCloud=n())}(this,function(){"use strict";function t(t,n){switch(n.toLowerCase()){case"rad":return t/2/Math.PI;case"deg":return function(t){return t/360}(t)}return t}function n(n,r,e,i,o,a,u,f,c){return n.map(function(n){var h=n.text;void 0===h&&(h=r);var v=n.weight;void 0===v&&(v=e);var d=n.rotation;void 0===d&&(d=i);var s=n.rotationUnit;void 0===s&&(s=o);var l=n.fontFamily;void 0===l&&(l=a);var g=n.fontStyle;void 0===g&&(g=u);var m=n.fontVariant;void 0===m&&(m=f);var p=n.fontWeight;return void 0===p&&(p=c),{text:h,weight:v,rotationTurn:t(d,s),get rotationRad(){return 2*this.rotationTurn*Math.PI},get rotationDeg(){return 360*this.rotationTurn},fontFamily:l,fontStyle:g,fontVariant:m,fontWeight:p,get font(){return t=this.fontStyle,n=this.fontVariant,r=this.fontWeight,e=this.fontSize,i=this.fontFamily,[t,n,r,e+"px",i].join(" ");var t,n,r,e,i},get rectLeft(){return this.left-this.rectWidth/2},get rectTop(){return this.top-this.rectHeight/2}}})}function r(t,n){if(t.length>0)return n&&(t=t.map(n)),t.reduce(function(t,n){return Math.min(t,n)})}function e(t,n){if(t.length>0)return n&&(t=t.map(n)),t.reduce(function(t,n){return Math.max(t,n)})}function i(t,n,r,e,i){return e+(t-n)*(i-e)/(r-n)}function o(t,n){var r=t.text,e=t.font,i=t.fontSize,o=t.rotationRad,a=n(),u=a.getContext("2d");u.font=e;var f,c,h,v=u.measureText(r).width,d=Math.max(u.measureText("m").width,i),s=(f=v,c=i,h=o,[Math.ceil(f*Math.abs(Math.cos(h))+c*Math.abs(Math.sin(h))),Math.ceil(f*Math.abs(Math.sin(h))+c*Math.abs(Math.cos(h)))]),l=s[0],g=s[1],m=l+2*d,p=g+2*d;a.width=m,a.height=p,u.translate(m/2,p/2),u.rotate(o),u.font=e,u.textAlign="center",u.textBaseline="middle",u.fillText(r,0,0);var M=u.getImageData(0,0,m,p).data;return[v,l,g,M=function(t,n,r){for(var e=new Uint8Array(n*r),i=0,o=t.length;i<o;++i)e[i]=t[4*i+3]?1:0;return e}(M,m,p),m,p]}function a(t){var n;return function(t,r,e){var i,o=function(t,n,r){for(var e=[],i=0;i<n;++i)for(var o=0;o<r;++o)t[n*o+i]&&e.push([i,o]);return e}(t,r,e),a=-Math.floor(r/2),u=-Math.floor(e/2);n?(i=function(t,n,r){for(var e=n[0],i=n[1],o=Math.random()<.5?1:-1,a=Math.random()<.5?1:-1;!r([e,i]);)e+=o,i+=a;return[e,i]}(0,[a,u],function(t){var r=t[0],e=t[1];return o.every(function(t){var i=t[0],o=t[1];return!n[r+i+"|"+(e+o)]})}),a=i[0],u=i[1]):n={};return o.forEach(function(t){var r=t[0],e=t[1];n[a+r+"|"+(u+e)]=!0}),[a,u]}}return function(t,u,f,c){void 0===c&&(c={});var h=c.text;void 0===h&&(h="");var v=c.weight;void 0===v&&(v=1);var d=c.rotation;void 0===d&&(d=0);var s=c.rotationUnit;void 0===s&&(s="rad");var l=c.fontFamily;void 0===l&&(l="serif");var g=c.fontStyle;void 0===g&&(g="normal");var m=c.fontVariant;void 0===m&&(m="normal");var p=c.fontWeight;void 0===p&&(p="normal");var M=c.fontSizeRatio;void 0===M&&(M=0);var x,w=c.createCanvas;if(void 0===w&&(w=function(){return document.createElement("canvas")}),t.length>0&&u>0&&f>0){t=n(t,h,v,d,s,l,g,m,p),x=function(t){return-t.weight};var y=function(t,n){var o=r(t,function(t){return t.weight}),a=e(t,function(t){return t.weight});if(o<a&&n>0&&n<1/0)return n<1&&(n=1/n),t.map(function(t){return i(t.weight,o,a,1,n)});if(o>0)return t.map(function(t){return t.weight/o});var u=1+Math.abs(o)+Math.abs(a);return t.map(function(t){return i(t.weight,o,a,1,u)})}(t=t.map(function(t){return[x(t),t]}).sort(function(t,n){var r=t[0],e=n[0];return r>e?1:r<e?-1:0}).map(function(t){return t[1]}),M),W=a();return t.forEach(function(t,n){var r=y[n];Object.assign(t,{fontSize:r});var e=o(t,w),i=e[0],a=e[1],u=e[2],f=e[3],c=e[4],h=e[5],v=W(f,c,h),d=v[0]+c/2,s=v[1]+h/2;Object.assign(t,{textWidth:i,rectWidth:a,rectHeight:u,left:d,top:s})}),function(t,n,i){var o=r(t,function(t){return t.rectLeft}),a=e(t,function(t){return t.rectLeft+t.rectWidth}),u=a-o,f=a+o,c=r(t,function(t){return t.rectTop}),h=e(t,function(t){return t.rectTop+t.rectHeight}),v=h-c,d=h+c,s=Math.min(n/u,i/v);t.forEach(function(t){t.left-=f/2,t.top-=d/2,t.fontSize*=s,t.textWidth*=s,t.textHeight*=s,t.rectWidth*=s,t.rectHeight*=s,t.left*=s,t.top*=s,t.left+=n/2,t.top+=i/2})}(t,u,f),t}return[]}});
