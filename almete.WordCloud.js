!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(t.almete=t.almete||{},t.almete.WordCloud=r())}(this,function(){"use strict";function t(t,r){if(t.length>0)return r&&(t=t.map(r)),t.reduce(function(t,r){return Math.min(t,r)})}function r(t,r){if(t.length>0)return r&&(t=t.map(r)),t.reduce(function(t,r){return Math.max(t,r)})}function e(t,r,e){var n=e().getContext("2d");return n.font=r,n.measureText(t).width}function n(t,r,e){var n,i,o=t[0],a=t[1],f=r[0],h=r[1];o>a?(n=1,i=a/o):a>o?(i=1,n=o/a):n=i=1;var u=[f,h];if(e(u))return u;for(var v=f,c=h,d=f,s=h,l=v,g=c;;){f-=n,h-=i,v+=n,c+=i;var m=Math.floor(f),x=Math.floor(h),M=Math.ceil(v),p=Math.ceil(c);if(M>l)for(var W=x;W<p;++W){var y=[M,W];if(e(y))return y}if(p>g)for(var w=M;w>m;--w){var S=[w,p];if(e(S))return S}if(m<d)for(var T=p;T>x;--T){var z=[m,T];if(e(z))return z}if(x<s)for(var R=m;R<M;++R){var b=[R,x];if(e(b))return b}d=m,s=x,l=M,g=p}}var i=4;return function(o,a,f,h){void 0===h&&(h={});var u=h.text;void 0===u&&(u="");var v=h.weight;void 0===v&&(v=1);var c=h.rotation;void 0===c&&(c=0);var d=h.rotationUnit;void 0===d&&(d="turn");var s=h.fontFamily;void 0===s&&(s="serif");var l=h.fontStyle;void 0===l&&(l="normal");var g=h.fontVariant;void 0===g&&(g="normal");var m=h.fontWeight;void 0===m&&(m="normal");var x=h.spacing;void 0===x&&(x=0);var M=h.fontSizeRatio;void 0===M&&(M=0);var p=h.createCanvas;if(void 0===p&&(p=function(){return document.createElement("canvas")}),o.length>0&&a>0&&f>0){o=o.map(function(t){var r=t.text;void 0===r&&(r=u);var e=t.weight;void 0===e&&(e=v);var n=t.rotation;void 0===n&&(n=c);var i=t.rotationUnit;void 0===i&&(i=d);var o=t.fontFamily;void 0===o&&(o=s);var a=t.fontStyle;void 0===a&&(a=l);var f=t.fontVariant;void 0===f&&(f=g);var h=t.fontWeight;return void 0===h&&(h=m),{text:r,weight:e,rotationTurn:function(){switch(i){case"deg":return n/360;case"rad":return function(t){return t/2/Math.PI}(n)}return n}(),get rotationDeg(){return 360*this.rotationTurn},get rotationRad(){return 2*this.rotationTurn*Math.PI},fontFamily:o,fontStyle:a,fontVariant:f,fontWeight:h,get font(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize+"px",this.fontFamily].join(" ")},get rectWidth(){return Math.ceil(this.textWidth*Math.abs(Math.cos(this.rotationRad))+this.fontSize*Math.abs(Math.sin(this.rotationRad)))},get rectHeight(){return Math.ceil(this.textWidth*Math.abs(Math.sin(this.rotationRad))+this.fontSize*Math.abs(Math.cos(this.rotationRad)))},get rectLeft(){return this.left-this.rectWidth/2},get rectTop(){return this.top-this.rectHeight/2}}}),(M=Math.abs(M))>1&&(M=1/M),o.sort(function(t,r){return r.weight-t.weight});var W=o[0].weight,y=o[o.length-1].weight;y<W?(M=M>0?1/M:y>0?W/y:W<0?y/W:1+W-y,o.forEach(function(t){var r,e,n;t.fontSize=i*(r=t.weight,(n=1)+(r-(e=y))*(M-n)/(W-e))})):o.forEach(function(t){t.fontSize=i});var w=o[0];if(w.textWidth=e(w.text,w.font,p),w.left=0,w.top=0,o.length>1){var S,T,z,R,b,E=function(){T=2+2*w.rectWidth,z=2+2*w.rectHeight,R=-Math.floor(T/2),b=-Math.floor(z/2);var t=function(t,r,e,n,i,o,a){var f=a(),h=f.getContext("2d");return f.width=i,f.height=o,h.translate(i/2,o/2),h.rotate(n),h.font=r,h.textAlign="center",h.textBaseline="middle",h.fillText(t,0,0),e>0&&(h.miterLimit=1,h.lineWidth=e,h.strokeText(t,0,0)),h.getImageData(0,0,i,o).data}(w.text,w.font,2*i*x,w.rotationRad,T,z,p);S=[];for(var r=0;r<T;++r)for(var e=0;e<z;++e)t[4*(T*e+r)+3]&&S.push([r,e])};E();for(var C={},F=1,H=o.length;F<H;++F){var L;S.forEach(function(t){var r=t[0],e=t[1];C[R+r+"|"+(b+e)]=!0}),(w=o[F]).textWidth=e(w.text,w.font,p),E(),L=n([a,f],[R,b],function(t){var r=t[0],e=t[1];return S.every(function(t){var n=t[0],i=t[1];return!C[r+n+"|"+(e+i)]})}),R=L[0],b=L[1],w.left=R+T/2,w.top=b+z/2}}var V=t(o,function(t){return t.rectLeft}),I=r(o,function(t){return t.rectLeft+t.rectWidth}),j=I-V,D=I+V,P=t(o,function(t){return t.rectTop}),U=r(o,function(t){return t.rectTop+t.rectHeight}),k=U-P,A=U+P,B=Math.min(a/j,f/k);return o.forEach(function(t){t.left-=D/2,t.top-=A/2,t.fontSize*=B,t.textWidth*=B,t.left*=B,t.top*=B,t.left+=a/2,t.top+=f/2}),o}return[]}});
