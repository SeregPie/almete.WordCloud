!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t.almete=t.almete||{},t.almete.WordCloud=i())}(this,function(){"use strict";function t(t,i,n){return Math.ceil(t*Math.abs(Math.sin(n))+i*Math.abs(Math.cos(n)))}function i(t,i,n){return Math.ceil(t*Math.abs(Math.cos(n))+i*Math.abs(Math.sin(n)))}var n=function(t,i,n,r,o,h,u){this.t=t,this.i=i,this.n=n,this.r=r,this.o=o,this.h=h,this.u=u,this.a=1,this.e=0,this.f=0,this.s=0},r={c:{configurable:!0},v:{configurable:!0},d:{configurable:!0},g:{configurable:!0},l:{configurable:!0},b:{configurable:!0},M:{configurable:!0},m:{configurable:!0},x:{configurable:!0},p:{configurable:!0},B:{configurable:!0},W:{configurable:!0},T:{configurable:!0},w:{configurable:!0},y:{configurable:!0},S:{configurable:!0},L:{configurable:!0},j:{configurable:!0},D:{configurable:!0},H:{configurable:!0},z:{configurable:!0},O:{configurable:!0}};r.c.get=function(){return 360*this.i},r.v.get=function(){return this.i*Math.PI*2},r.d.get=function(){return this.a},r.d.set=function(t){this.a!==t&&(this.a=t,this.P=void 0)},r.g.get=function(){return t=this.r,i=this.o,n=this.h,r=this.d,o=this.n,[t,i,n,r+"px",o].join(" ");var t,i,n,r,o},r.l.get=function(){var t,i,n,r;return void 0===this.R&&(this.R=(t=this.t,i=this.g,n=this.u,(r=n().getContext("2d")).font=i,r.measureText(t).width/this.d)),this.R},r.b.get=function(){return this.l*this.d},r.M.get=function(){return this.f*this.d},r.M.set=function(t){this.f=t/this.d},r.m.get=function(){return this.s*this.d},r.m.set=function(t){this.s=t/this.d},r.x.get=function(){return i(this.b,this.d,this.v)},r.p.get=function(){return t(this.b,this.d,this.v)},r.B.get=function(){return this.M-this.x/2},r.W.get=function(){return this.m-this.p/2},r.T.get=function(){return this.e},r.T.set=function(t){this.e!==t&&(this.e=t,this.P=void 0)},r.w.get=function(){return this.T*this.d},r.y.get=function(){return void 0===this.P&&(this.P=function(t,i,n,r,o,h,u){var a=u(),e=a.getContext("2d");a.width=o,a.height=h,e.translate(o/2,h/2),e.rotate(r),e.font=i,e.textAlign="center",e.textBaseline="middle",e.fillText(t,0,0),n>0&&(e.miterLimit=1,e.lineWidth=n,e.strokeText(t,0,0));for(var f=e.getImageData(0,0,o,h).data,s=[],c=1/0,v=0,d=1/0,g=0,l=0;l<o;++l)for(var b=0;b<h;++b)f[4*(o*b+l)+3]&&(s.push([l,b]),c=Math.min(l,c),v=Math.max(l+1,v),d=Math.min(b,d),g=Math.max(b+1,g));return s.length<1?[s,0,0,0,0]:[s.map(function(t){var i=t[0],n=t[1];return[i-c,n-d]}),v-c,g-d,Math.ceil(o/2)-c,Math.ceil(h/2)-d]}(this.t,this.g,2*this.w,this.v,i(this.b+2*(this.w+this.d),this.d+2*(this.w+this.d),this.v),t(this.b+2*(this.w+this.d),this.d+2*(this.w+this.d),this.v),this.u)),this.P},r.S.get=function(){return this.y[0]},r.L.get=function(){return this.y[1]},r.j.get=function(){return this.y[2]},r.D.get=function(){return this.y[3]},r.H.get=function(){return this.y[4]},r.z.get=function(){return Math.ceil(this.M)-this.D},r.z.set=function(t){this.M=t+this.D},r.O.get=function(){return Math.ceil(this.m)-this.H},r.O.set=function(t){this.m=t+this.H},Object.defineProperties(n.prototype,r);var o=function(t){this.F=t,this.V()},h={M:{configurable:!0},m:{configurable:!0},k:{configurable:!0},q:{configurable:!0}};return h.M.get=function(){return Math.ceil((this.A+this.C)/2)},h.m.get=function(){return Math.ceil((this.G+this.I)/2)},h.k.get=function(){return this.C-this.A},h.q.get=function(){return this.I-this.G},o.prototype.J=function(t,i,n){var r=this;t.forEach(function(t){var o=t[0],h=t[1],u=i+o,a=n+h;r.K[u+"|"+a]=!0,r.A=Math.min(u,r.A),r.C=Math.max(u+1,r.C),r.G=Math.min(a,r.G),r.I=Math.max(a+1,r.I)})},o.prototype.N=function(t,i,n){var r=this;return t.every(function(t){var o=t[0],h=t[1],u=i+o,a=n+h;return!r.K[u+"|"+a]})},o.prototype.Q=function(t,i,n){var r=this;return function(t,i,n){var r,o,h=t[0],u=t[1],a=i[0],e=i[1];h>u?(r=1,o=u/h):u>h?(o=1,r=h/u):r=o=1;var f=[a,e];if(n(f))return f;for(var s=a,c=e,v=a,d=e,g=s,l=c;;){a-=r,e-=o,s+=r,c+=o;var b=Math.floor(a),M=Math.floor(e),m=Math.ceil(s),x=Math.ceil(c);if(m>g)for(var p=M;p<x;++p){var B=[m,p];if(n(B))return B}if(x>l)for(var W=m;W>b;--W){var T=[W,x];if(n(T))return T}if(b<v)for(var w=x;w>M;--w){var y=[b,w];if(n(y))return y}if(M<d)for(var S=b;S<m;++S){var L=[S,M];if(n(L))return L}v=b,d=M,g=m,l=x}}(this.F,[i+this.M,n+this.m],function(i){var n=i[0],o=i[1];return r.N(t,n,o)})},o.prototype.V=function(){this.K={},this.A=0,this.C=0,this.G=0,this.I=0},Object.defineProperties(o.prototype,h),function(t,i,r,h){void 0===h&&(h={});var u=h.text;void 0===u&&(u="");var a=h.weight;void 0===a&&(a=1);var e=h.rotation;void 0===e&&(e=0);var f=h.rotationUnit;void 0===f&&(f="turn");var s=h.fontFamily;void 0===s&&(s="serif");var c=h.fontStyle;void 0===c&&(c="normal");var v=h.fontVariant;void 0===v&&(v="normal");var d=h.fontWeight;void 0===d&&(d="normal");var g=h.spacing;void 0===g&&(g=0);var l=h.fontSizeRatio;void 0===l&&(l=0);var b=h.renderingFontSizeInterval;void 0===b&&(b=2);var M=h.renderingFontSizeBase;void 0===M&&(M=4);var m=h.createCanvas;if(void 0===m&&(m=function(){return document.createElement("canvas")}),(l=Math.abs(l))>1&&(l=1/l),i>0&&r>0&&(t=t.map(function(t){var i=t.text;void 0===i&&(i=u);var r=t.weight;void 0===r&&(r=a);var o=t.rotation;void 0===o&&(o=e);var h=t.rotationUnit;void 0===h&&(h=f);var g=t.fontFamily;void 0===g&&(g=s);var l=t.fontStyle;void 0===l&&(l=c);var b=t.fontVariant;void 0===b&&(b=v);var M=t.fontWeight;void 0===M&&(M=d);var x=new n(i,function(){switch(h){case"deg":return o/360;case"rad":return function(t){return t/2/Math.PI}(o)}return o}(),g,l,b,M,m);return x.U=r,x}).filter(function(t){return t.b>0}).sort(function(t,i){return i.U-t.U})).length>0){var x=t[0],p=function(t){return t[t.length-1]}(t),B=x.U,W=p.U;if(W<B){var T=l>0?1/l:W>0?B/W:B<0?W/B:1+B-W;t.forEach(function(t){var i,n,r;t.d=(i=t.U,(r=1)+(i-(n=W))*(T-r)/(B-n))})}t.reduceRight(function(t,i){return i.d<b*t?i.d/=t:(t=i.d,i.d=1),i.X=t},1),t.forEach(function(t){t.d*=M});var w=new o([i,r]);if(t.reduce(function(i,n,r){if(n.X<i.X){w.V();var o=i.X/n.X;t.slice(0,r).forEach(function(t){t.d*=o,w.J(t.S,t.z,t.O)})}else w.J(i.S,i.z,i.O);n.T=g;var h=w.Q(n.S,n.z,n.O),u=h[0],a=h[1];return n.z=u,n.O=a,n.T=0,n}),w.J(p.S,p.z,p.O),w.k>0&&w.q>0){var y=Math.min(i/w.k,r/w.q);t.forEach(function(t){t.M-=w.M,t.m-=w.m,t.d*=y,t.M+=i/2,t.m+=r/2})}return t.map(function(t){return{text:t.t,weight:t.U,rotationTurn:t.i,rotationDeg:t.c,rotationRad:t.v,fontStyle:t.r,fontVariant:t.o,fontWeight:t.h,fontSize:t.d,fontFamily:t.n,font:t.g,textWidth:t.b,boundingBoxWidth:t.x,boundingBoxHeight:t.p,boundingBoxLeft:t.B,boundingBoxTop:t.W,left:t.M,top:t.m}})}return[]}});
