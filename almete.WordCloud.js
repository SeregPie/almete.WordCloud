!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t.almete=t.almete||{},t.almete.WordCloud=n())}(this,function(){"use strict";function t(t,n){if(t.length>0)return n&&(t=t.map(n)),t.reduce(function(t,n){return Math.min(t,n)})}function n(t,n){if(t.length>0)return n&&(t=t.map(n)),t.reduce(function(t,n){return Math.max(t,n)})}function e(t,n,e,r,i){return r+(t-n)*(i-r)/(e-n)}return function(r,i,o,a){void 0===a&&(a={});var f=a.text;void 0===f&&(f="");var u=a.weight;void 0===u&&(u=1);var c=a.rotation;void 0===c&&(c=0);var h=a.fontFamily;void 0===h&&(h="serif");var v=a.fontStyle;void 0===v&&(v="normal");var d=a.fontVariant;void 0===d&&(d="normal");var m=a.fontWeight;void 0===m&&(m="normal");var l=a.fontSizeRatio;void 0===l&&(l=0);var g,p=a.createCanvas;if(void 0===p&&(p=function(){return document.createElement("canvas")}),r.length>0&&i>0&&o>0){r=function(t,n,e,r,i,o,a,f){return t.map(function(t){var u=t.text;void 0===u&&(u=n);var c=t.weight;void 0===c&&(c=e);var h=t.rotation;void 0===h&&(h=r);var v=t.fontFamily;void 0===v&&(v=i);var d=t.fontStyle;void 0===d&&(d=o);var m=t.fontVariant;void 0===m&&(m=a);var l=t.fontWeight;return void 0===l&&(l=f),{text:u,weight:c,rotation:h,fontFamily:v,fontStyle:d,fontVariant:m,fontWeight:l}})}(r,f,u,c,h,v,d,m),g=function(t){return-t.weight};var s=function(r,i){var o=t(r,function(t){return t.weight}),a=n(r,function(t){return t.weight});if(o<a&&i>0&&i<1/0)return i<1&&(i=1/i),r.map(function(t){return e(t.weight,o,a,1,i)});if(o>0)return r.map(function(t){return t.weight/o});var f=1+Math.abs(o)+Math.abs(a);return r.map(function(t){return e(t.weight,o,a,1,f)})}(r=r.map(function(t){return[g(t),t]}).sort(function(t,n){var e=t[0],r=n[0];return e>r?1:e<r?-1:0}).map(function(t){return t[1]}),l),M=r.map(function(t,n){var e=t.text,r=(t.weight,t.rotation),i=t.fontFamily,o=t.fontStyle,a=t.fontVariant,f=t.fontWeight,u=s[n],c=function(t,n,e,r,i,o,a){var f=[n,e,r,i+"px",o].join(" "),u=a().getContext("2d");return u.font=f,u.measureText(t).width}(e,o,a,f,u,i,p),h=function(t,n,e){return[Math.ceil(t*Math.abs(Math.cos(e))+n*Math.abs(Math.sin(e))),Math.ceil(t*Math.abs(Math.sin(e))+n*Math.abs(Math.cos(e)))]}(c,u,r),v=h[0],d=h[1];return{text:e,rotation:r,fontStyle:o,fontVariant:a,fontWeight:f,fontSize:u,fontFamily:i,textWidth:c,rectWidth:v,rectHeight:d,rectLeft:-v/2,rectTop:-d/2}});return function(e,r,i){var o=t(e,function(t){return t.rectLeft}),a=n(e,function(t){return t.rectLeft+t.rectWidth})-o,f=t(e,function(t){return t.rectTop}),u=n(e,function(t){return t.rectTop+t.rectHeight})-f,c=Math.min(r/a,i/u);e.forEach(function(t){t.fontSize*=c,t.textWidth*=c,t.textHeight*=c,t.rectWidth*=c,t.rectHeight*=c,t.rectLeft*=c,t.rectTop*=c})}(M,i,o),function(t,n,e){t.forEach(function(t){t.rectLeft+=n/2,t.rectTop+=e/2})}(M,i,o),M}return[]}});
