!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(t.almete=t.almete||{},t.almete.WordCloud=r())}(this,function(){"use strict";function t(t,r){if(t.length>0)return r&&(t=t.map(r)),t.reduce(function(t,r){return Math.min(t,r)})}function r(t,r){if(t.length>0)return r&&(t=t.map(r)),t.reduce(function(t,r){return Math.max(t,r)})}function e(t,r,e){var n=e().getContext("2d");return n.font=r,n.measureText(t).width}function n(t,r,e,n,i,o,a){var f=a(),h=f.getContext("2d");f.width=i,f.height=o,h.translate(i/2,o/2),h.rotate(n),h.font=r,h.textAlign="center",h.textBaseline="middle",h.fillText(t,0,0),e>0&&(h.miterLimit=1,h.lineWidth=e,h.strokeText(t,0,0));for(var u=h.getImageData(0,0,i,o).data,v=[],c=0;c<i;++c)for(var d=0;d<o;++d)u[4*(i*d+c)+3]&&v.push([c,d]);return v}function i(t,r,e){var n,i,o=t[0],a=t[1],f=r[0],h=r[1];o>a?(n=1,i=a/o):a>o?(i=1,n=o/a):n=i=1;var u=[f,h];if(e(u))return u;for(var v=f,c=h,d=f,l=h,s=v,g=c;;){f-=n,h-=i,v+=n,c+=i;var m=Math.floor(f),M=Math.floor(h),x=Math.ceil(v),p=Math.ceil(c);if(x>s)for(var W=M;W<p;++W){var y=[x,W];if(e(y))return y}if(p>g)for(var S=x;S>m;--S){var w=[S,p];if(e(w))return w}if(m<d)for(var T=p;T>M;--T){var z=[m,T];if(e(z))return z}if(M<l)for(var R=m;R<x;++R){var b=[R,M];if(e(b))return b}d=m,l=M,s=x,g=p}}var o=4;return function(a,f,h,u){var v;void 0===u&&(u={});var c=u.text;void 0===c&&(c="");var d=u.weight;void 0===d&&(d=1);var l=u.rotation;void 0===l&&(l=0);var s=u.rotationUnit;void 0===s&&(s="turn");var g=u.fontFamily;void 0===g&&(g="serif");var m=u.fontStyle;void 0===m&&(m="normal");var M=u.fontVariant;void 0===M&&(M="normal");var x=u.fontWeight;void 0===x&&(x="normal");var p=u.spacing;void 0===p&&(p=0);var W=u.fontSizeRatio;void 0===W&&(W=0);var y=u.createCanvas;if(void 0===y&&(y=function(){return document.createElement("canvas")}),a.length>0&&f>0&&h>0){a=a.map(function(t){var r=t.text;void 0===r&&(r=c);var e=t.weight;void 0===e&&(e=d);var n=t.rotation;void 0===n&&(n=l);var i=t.rotationUnit;void 0===i&&(i=s);var o=t.fontFamily;void 0===o&&(o=g);var a=t.fontStyle;void 0===a&&(a=m);var f=t.fontVariant;void 0===f&&(f=M);var h=t.fontWeight;return void 0===h&&(h=x),{text:r,weight:e,rotationTurn:function(){switch(i){case"deg":return n/360;case"rad":return function(t){return t/2/Math.PI}(n)}return n}(),get rotationDeg(){return 360*this.rotationTurn},get rotationRad(){return this.rotationTurn*Math.PI*2},fontFamily:o,fontStyle:a,fontVariant:f,fontWeight:h,get font(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize+"px",this.fontFamily].join(" ")},get rectWidth(){return Math.ceil(this.textWidth*Math.abs(Math.cos(this.rotationRad))+this.fontSize*Math.abs(Math.sin(this.rotationRad)))},get rectHeight(){return Math.ceil(this.textWidth*Math.abs(Math.sin(this.rotationRad))+this.fontSize*Math.abs(Math.cos(this.rotationRad)))},get rectLeft(){return this.left-this.rectWidth/2},get rectTop(){return this.top-this.rectHeight/2}}}),(W=Math.abs(W))>1&&(W=1/W),a.sort(function(t,r){return r.weight-t.weight});var S=a[0].weight,w=a[a.length-1].weight;w<S?(W=W>0?1/W:w>0?S/w:S<0?w/S:1+S-w,a.forEach(function(t){var r,e,n;t.fontSize=o*(r=t.weight,(n=1)+(r-(e=w))*(W-n)/(S-e))})):a.forEach(function(t){t.fontSize=o});var T=a[0];if(T.textWidth=e(T.text,T.font,y),T.left=0,T.top=0,a.length>1)for(var z,R={},b=2+2*T.rectWidth,E=2+2*T.rectHeight,H=-Math.floor(b/2),C=-Math.floor(E/2),F=1,L=a.length;F<L;++F)(z=n(T.text,T.font,0,T.rotationRad,b,E,y)).forEach(function(t){var r=t[0],e=t[1];R[H+r+"|"+(C+e)]=!0}),(T=a[F]).textWidth=e(T.text,T.font,y),b=2+2*T.rectWidth,E=2+2*T.rectHeight,z=n(T.text,T.font,T.fontSize*p*2,T.rotationRad,b,E,y),H=-Math.floor(b/2),C=-Math.floor(E/2),v=i([f,h],[H,C],function(t){var r=t[0],e=t[1];return z.every(function(t){var n=t[0],i=t[1];return!R[r+n+"|"+(e+i)]})}),H=v[0],C=v[1],T.left=H+b/2,T.top=C+E/2;var V=t(a,function(t){return t.rectLeft}),I=r(a,function(t){return t.rectLeft+t.rectWidth}),j=I-V,D=I+V,P=t(a,function(t){return t.rectTop}),U=r(a,function(t){return t.rectTop+t.rectHeight}),k=U-P,A=U+P,B=Math.min(f/j,h/k);return a.forEach(function(t){t.left-=D/2,t.top-=A/2,t.fontSize*=B,t.textWidth*=B,t.left*=B,t.top*=B,t.left+=f/2,t.top+=h/2}),a}return[]}});
